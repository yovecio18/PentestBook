# Troubleshooting
```
[-] Kerberos SessionError: KDC_ERR_PREAUTH_FAILED(Pre-authentication information was invalid)
```
If you see this error when trying to use the genr generated TGS to login ex via psxec then the issue is most likely that you are not using the FQDN but instead the ip. 
If you generate with this:
```
 getST.py -spn 'cifs/DC02.DEV.ADMIN.OFFSHORE.COM' -dc-ip 172.16.2.6 <SNIP>
```
 Then you have to login with same name(must be resolvable by the DNS as well)
```
 impacket-psexec <SNIP>@DC02.DEV.ADMIN.OFFSHORE.COM -k -no-pass
```
**OBS**: as you see here the *@FQDN* matches exactly the value defined in the **-spn**. This is extremely important as Kerbeos is very problematic when the DNS names must match and even if on DNS should work on Kerberos is another story.


# ms-ds-machineaccountquota
If you find yourself in a Windows DC machine where your username have the possibility to add workstations to AD then you can follow 2 possible scenarios.
Reference: https://www.thehacker.recipes/ad/movement/domain-settings/machineaccountquota
1)NOPAC:https://github.com/Ridter/noPac
If you use this one, it will be pretty easy as it will do basically all the job for you. 
OBS: it is a CVE so it might not work if the target has been patched!

2)Use Kerberos RBCD, I have a usefull guide in the same folder(PART #3)
Reference: https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd
**Basically you add a new computer, add a delegation to the computer object to gain Generic write over the object by the DC via attribute AllowedToActOnBehalfOfOtherIdentity .**
Then perform the S4U (Service For User) to get a TGT that will be used for impersonation.
Enjoy!


