## Custom Queries
If you will ever need some custom queries to satisfy strange need here you can find some...

Getting all users
```shell-session
MATCH (u:User) RETURN u
```

Getting a specific user
```shell-session
MATCH (u:User {name:"PETER@INLANEFREIGHT.HTB"}) RETURN u
```

Show group membership of a user.
```shell-session
MATCH (u:User {name:"PETER@INLANEFREIGHT.HTB"})-[r:MemberOf]->(peterGroups) 
RETURN peterGroups
```

Getting a specific users membership.
```shell-session
MATCH p=((u:User {name:"PETER@INLANEFREIGHT.HTB"})-[r:MemberOf*1..]->(g:Group)) 
RETURN p
```

Shortest path from a specific user to any "node".
```shell-session
MATCH p = shortestPath((n)-[*1..]->(c)) 
WHERE n.name =~ '(?i)peter.*' AND NOT c=n 
RETURN p
```

Find dangerous rights that *Domain Users shouldn't have.*
```shell-session
MATCH p=(g:Group)-[r:Owns|WriteDacl|GenericAll|WriteOwner|ExecuteDCOM|GenericWrite|AllowedToDelegate|ForceChangePassword]->(c:Computer) 
WHERE g.name STARTS WITH "DOMAIN USERS" 
RETURN p
```

Find users with *not void* description.
```shell-session
MATCH (u:User) 
WHERE u.description IS NOT NULL 
RETURN u.name,u.description
```

Find any *WriteSPN* action available.
```shell-session
MATCH p=((n)-[r:WriteSPN]->(m)) RETURN p
```

Find all Admins and the host on where they are admin.
```shell-session
MATCH (c:Computer) OPTIONAL MATCH (u1:User)-[:AdminTo]->(c) OPTIONAL MATCH (u2:User)-[:MemberOf*1..]->(:Group)-[:AdminTo]->(c) WITH COLLECT(u1) + COLLECT(u2) AS TempVar,c UNWIND TempVar AS Admins 
RETURN c.name AS COMPUTER, COUNT(DISTINCT(Admins)) AS ADMIN_COUNT,COLLECT(DISTINCT(Admins.name)) AS USERS 
ORDER BY ADMIN_COUNT DESC
```


## Tips
In case you are gathering dump via Bloodhound python and you think you are missing data, try to use the *Sharphound.exe* as well!
### Scan Several domains
You can scan several domains in one go(*useful for Trusted domains*).
```powershell-session
.\SharpHound.exe -d 'inlanefreight.ad' 'child.inlanefreight.ad' 'apexcargo.ad' -c All
```


# Useful Tools
## Bluehound
If you are part of a *BlueTeam SOC* you might want to check this tool as it parses and analyzes automatically the results with custom dashboard, cycling fetching with sharphound tools , reportings and highky customizable.
https://github.com/zeronetworks/BlueHound

1) Start the console and login to the Neo4j database.
2) Click on *"Data Import"* and choose the interested collections method(Sharphound, Plumhound etc).
3) Click on *"Configurations"* and set manually the DA group, DC and Crown server.
4) Run all the query manually to refresh your dashboard and enjoy.
You can find a custom dashboard example in the same folder.

## Improhound(Win ONLY)
This other variant is useful when the AD is using the *Microsoft's AD Tiering* model.
https://github.com/improsec/ImproHound

1) Start the console and login to the Neo4j database.
2) The tool should be able to match the Tier modelling on the defined AD. Can manually set every "node" as the tiering model you need.
3) Click on **"Get Tiering Violations"** to export a CSV list with all the violations, this should help you immensely to map and understand misconfiguration in the tiering model.

## Plumhound
If you are noob and need a clarification on how to exploit paths between nodes then you can use this tool. 
[PlumHound/PlumHound: Bloodhound Reporting for Blue and Purple Teams (github.com)](https://github.com/PlumHound/PlumHound)

```shell-session
python PlumHound.py -p Password123 -ap "DOMAIN USERS@INLANEFREIGHT.HTB" "WS01.INLANEFREIGHT.HTB"
```
(This will analyze the attack path between *Domain Users* and *WS01.*)
