**HTTP Request Smuggling aka (DESYNC Attack)**
The HTTP request smuggling is advanced attack that targets HTTP protocol, specifically the communication between a fronted(ex: proxy/LB) and the backend(webserver) by tampering the request so the backend fails into parsing those TCP requests.

## TCP Streams
In tcp protocol the information is sent via consequent chunks(Streams), specifically in the HTTP 1.1 version is using the same TCP socket to send several TCP streams to make it faster. This means that several TCP chunks(streams) will be send consequently one from another with no separations between each other.

## TCP Steam Example
In the following example there are a first POST request sending a HELLO, followed by a GET request.
```

POST / HTTP/1.1
Host: clte.htb
Content-Length: 5

HELLOGET / HTTP/1.1
Host: clte.htb
```

## Content-Length vs Transfer-Encoding
In the TCP streams both front-end/back-end need to know exactly how big is the request in order to be able to distinguish between start/end of every stream since as we know all the stream are not separated by any space whatsoever to do so there are 2 different HTTP headers that are used in a HTTP request header:

## Content-lenght
In the Content-Length by **29bytes** the back-end that will receive the request knows exactly that the body request will be exactly **29bytes** long and with that will know how when the tcp stream ends!
```
POST / HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 29
param1=HelloWorld&param2=Test
```


## Transfer-Encoding
In this mode there will be a chunked indication that tells the TE mode is used and the stream is chunked(several stream). In this case the chunks indicate the following line size in HEX notation, example **1d(hex)=29 (bytes)** which means the following line will be **29 bytes long**.
The 0 ends the stream as the following line will be 0 bytes long also denoting the ending of the line!
```
POST / HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked
1d
param1=HelloWorld&param2=Test
0
```


## Desync attack
Now that we have an idea on how TCP streams are sent from reverse proxy --> web-server the desycn attack happens when the hacker tampers the TCP stream to create a misalignment in the streams between the reverse proxy(front-end) --> web-server (back-end) and a desyncronization happens. The attacker will use CRLF tags in order to tamper the chunks and exploit proxy/web-server etc.